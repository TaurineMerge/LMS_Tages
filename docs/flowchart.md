flowchart TD
    A[–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ LMS] --> B{–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –¥–æ—Å—Ç—É–ø–∞}
    
    B --> C[–ü—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø]
    B --> D[–ó–∞—â–∏—â–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø]
    
    %% –ü—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø
    subgraph C [–ü—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø - –±–µ–∑ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏]
        C1[–ó–∞–ø—Ä–æ—Å –∫ /api/public/*] --> C2[Public Side API]
        C2 --> C3[–¢–æ–ª—å–∫–æ –æ–ø–µ—Ä–∞—Ü–∏–∏ —á—Ç–µ–Ω–∏—è]
        C3 --> C4{–î–µ–π—Å—Ç–≤–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è}
        C4 --> C5[üëÅÔ∏è –ü—Ä–æ—Å–º–æ—Ç—Ä –∫—É—Ä—Å–æ–≤]
        C4 --> C6[üëÅÔ∏è –ü—Ä–æ—Å–º–æ—Ç—Ä —É—Ä–æ–∫–æ–≤]
        C4 --> C7[‚ùå –ü—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤]
        C4 --> C8[‚ùå –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏]
        C4 --> C9[‚ùå –°–æ–∑–¥–∞–Ω–∏–µ/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ]
    end
    
    %% –ó–∞—â–∏—â–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø
    D --> E{–ù–∞–ª–∏—á–∏–µ JWT —Ç–æ–∫–µ–Ω–∞?}
    
    E --> F[‚ùå –ù–µ—Ç —Ç–æ–∫–µ–Ω–∞]
    F --> F1[401 Unauthorized]
    F1 --> F2[–ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é]
    
    E --> G[‚úÖ –ï—Å—Ç—å —Ç–æ–∫–µ–Ω]
    G --> H[–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞ –≤ Keycloak]
    H --> I{–¢–æ–∫–µ–Ω –≤–∞–ª–∏–¥–µ–Ω?}
    
    I --> J[‚ùå –ù–µ–≤–∞–ª–∏–¥–µ–Ω/–ø—Ä–æ—Å—Ä–æ—á–µ–Ω]
    J --> J1[401 Unauthorized]
    J1 --> J2[–¢—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è]
    
    I --> K[‚úÖ –í–∞–ª–∏–¥–µ–Ω]
    K --> L[–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ä–æ–ª–µ–π –∏–∑ —Ç–æ–∫–µ–Ω–∞]
    L --> M{–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è}
    
    %% –°—Ç—É–¥–µ–Ω—Ç
    M --> N[–†–æ–ª—å: student]
    N --> O[–î–æ—Å—Ç—É–ø –∫ /api/personal/*]
    O --> P{–î–µ–π—Å—Ç–≤–∏—è —Å—Ç—É–¥–µ–Ω—Ç–∞}
    P --> Q[‚úÖ –ü—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤]
    P --> R[‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤]
    P --> S[‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏]
    P --> T[‚úÖ –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞]
    P --> U[‚ùå –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º]
    
    %% –ê–¥–º–∏–Ω/–£—á–∏—Ç–µ–ª—å
    M --> V[–†–æ–ª—å: admin/teacher]
    V --> W[–î–æ—Å—Ç—É–ø –∫ /api/admin/*]
    W --> X{–î–µ–π—Å—Ç–≤–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞}
    X --> Y[‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –∫—É—Ä—Å–æ–≤]
    X --> Z[‚úÖ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞]
    X --> AA[‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ —É—Ä–æ–∫–æ–≤]
    X --> AB[‚úÖ –ü—É–±–ª–∏–∫–∞—Ü–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤]
    X --> AC[‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–∞–º–∏]
    X --> AD[‚ùå –ü—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤ –∫–∞–∫ —Å—Ç—É–¥–µ–Ω—Ç]
    
    %% –ù–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø
    M --> AE[–†–æ–ª—å –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç/–Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤]
    AE --> AF[403 Forbidden]
    AF --> AG[–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω]
    
    %% –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è
    classDef public fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef student fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px
    classDef admin fill:#fce4ec,stroke:#c2185b,stroke-width:2px
    classDef error fill:#ffebee,stroke:#c62828,stroke-width:2px
    classDef success fill:#f1f8e9,stroke:#33691e,stroke-width:1px
    classDef neutral fill:#f5f5f5,stroke:#616161,stroke-width:1px
    
    class C,C1,C2,C3,C4,C5,C6,C7,C8,C9 public
    class N,O,P,Q,R,S,T,U student
    class V,W,X,Y,Z,AA,AB,AC,AD admin
    class F,F1,F2,J,J1,J2,AE,AF,AG error
    class E,G,H,I,K,L,M neutral