<!doctype html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Завершение — {{test.title}}</title>
  <style>
    :root{--bg:#fff;--text:#0b0b0b;--muted:#5f5f5f;--border:#e6e6e6;--orange:#ff6a00;--weak:rgba(255,106,0,.10);--shadow:0 8px 22px rgba(0,0,0,.08);--r:16px;}
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial}
    .wrap{max-width:820px;margin:0 auto;padding:28px 18px 50px}
    .card{border:1px solid var(--border);border-radius:var(--r);box-shadow:var(--shadow);padding:18px;background:#fff}
    .title{margin:0 0 8px 0;font-size:22px;letter-spacing:-.01em}
    .muted{color:var(--muted);line-height:1.55}
    .warn{margin-top:14px;padding:14px 14px;border-radius:14px;border:1px solid rgba(255,106,0,.45);background:var(--weak)}
    .list{margin:10px 0 0 0;padding-left:18px;color:#2a2a2a}
    .actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:16px}
    .btn{padding:11px 16px;border-radius:12px;border:1px solid var(--text);background:var(--text);color:#fff;cursor:pointer;font-weight:800;text-decoration:none}
    .btn-outline{padding:11px 16px;border-radius:12px;border:1px solid rgba(255,106,0,.85);background:transparent;color:var(--text);cursor:pointer;font-weight:800;text-decoration:none}
    .btn-danger{padding:11px 16px;border-radius:12px;border:1px solid rgba(255,106,0,.85);background:var(--orange);color:#fff;cursor:pointer;font-weight:900}
    .chip{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border:1px solid var(--border);border-radius:999px;background:#fff;font-size:13px}
    .dot{width:8px;height:8px;border-radius:999px;background:var(--orange)}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1 class="title">Завершить прохождение теста</h1>
      <div class="muted">{{test.title}}</div>

      <div style="margin-top:10px; display:flex; gap:10px; flex-wrap:wrap;">
        <div class="chip"><span class="dot"></span>Отвечено: <b>{{answeredCount}}</b> / <b>{{totalQuestions}}</b></div>
        {{#if test.min_point}}<div class="chip">Проходной: <b>{{test.min_point}}</b></div>{{/if}}
      </div>

      {{#if allAnswered}}
        <div class="warn">
          <b>Все ответы сохранены.</b>
          <div class="muted" style="margin-top:6px;">
            Можно завершать попытку и смотреть результаты.
          </div>
        </div>
      {{else}}
        <div class="warn">
          <b>Есть вопросы без ответа: {{missingCount}}.</b>
          <div class="muted" style="margin-top:6px;">
            Если завершить попытку сейчас, эти ответы останутся пустыми и в результатах дадут <b>0 баллов</b>.
          </div>
          <ul class="list">
            {{#each missingQuestions}}
              <li>Вопрос {{order}}</li>
            {{/each}}
          </ul>
        </div>
      {{/if}}

      <div class="actions">
        <a class="btn-outline" href="/ui/tests/{{test.id}}/take">Вернуться к тесту</a>

        <form method="post" action="/ui/tests/{{test.id}}/finish" style="margin:0;">
          <input type="hidden" name="student_id" value="{{student_id}}" />
          <input type="hidden" name="force" value="{{#if allAnswered}}true{{else}}true{{/if}}" />
          <button type="submit" class="{{#if allAnswered}}btn{{else}}btn-danger{{/if}}">
            {{#if allAnswered}}Завершить и открыть результаты{{else}}Завершить всё равно{{/if}}
          </button>
        </form>
      </div>

    </div>
  </div>
</body>
</html>