{"config":{"lang":["ru"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Personal Account - Technical Documentation","text":"<p>\u0414\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c \u0432 \u0442\u0435\u0445\u043d\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430\u0446\u0438\u044e \u0441\u0435\u0440\u0432\u0438\u0441\u0430 Personal Account \u0441\u0438\u0441\u0442\u0435\u043c\u044b \u043e\u043d\u043b\u0430\u0439\u043d-\u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u043d\u0438\u044f LMS Tages.</p>"},{"location":"#_1","title":"\u041e \u0441\u0435\u0440\u0432\u0438\u0441\u0435","text":"<p>Personal Account \u2014 \u044d\u0442\u043e FastAPI-\u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u0435, \u043f\u0440\u0435\u0434\u043e\u0441\u0442\u0430\u0432\u043b\u044f\u044e\u0449\u0435\u0435 REST API \u0434\u043b\u044f \u0443\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u044f \u043b\u0438\u0447\u043d\u044b\u043c \u043a\u0430\u0431\u0438\u043d\u0435\u0442\u043e\u043c \u0441\u0442\u0443\u0434\u0435\u043d\u0442\u0430:</p> <ul> <li>\u0423\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0441\u0442\u0443\u0434\u0435\u043d\u0442\u0430\u043c\u0438 \u2014 CRUD \u043e\u043f\u0435\u0440\u0430\u0446\u0438\u0438</li> <li>\u0421\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u044b \u2014 \u0432\u044b\u0434\u0430\u0447\u0430 \u0438 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0432</li> <li>\u041f\u043e\u0441\u0435\u0449\u0430\u0435\u043c\u043e\u0441\u0442\u044c \u2014 \u043e\u0442\u0441\u043b\u0435\u0436\u0438\u0432\u0430\u043d\u0438\u0435 \u043f\u043e\u0441\u0435\u0449\u0435\u043d\u0438\u0439</li> <li>\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f \u2014 \u0438\u043d\u0442\u0435\u0433\u0440\u0430\u0446\u0438\u044f \u0441 Keycloak OAuth2</li> </ul>"},{"location":"#_2","title":"\u0411\u044b\u0441\u0442\u0440\u044b\u0439 \u0441\u0442\u0430\u0440\u0442","text":""},{"location":"#swagger-ui-api","title":"Swagger UI (\u0438\u043d\u0442\u0435\u0440\u0430\u043a\u0442\u0438\u0432\u043d\u0430\u044f \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430\u0446\u0438\u044f API)","text":"<p>\u0418\u043d\u0442\u0435\u0440\u0430\u043a\u0442\u0438\u0432\u043d\u0430\u044f \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430\u0446\u0438\u044f API \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u0430 \u043f\u043e \u0430\u0434\u0440\u0435\u0441\u0443:</p> <ul> <li>Swagger UI \u2014 \u0434\u043b\u044f \u0442\u0435\u0441\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f API endpoints</li> </ul>"},{"location":"#_3","title":"\u0421\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0430 \u043f\u0440\u043e\u0435\u043a\u0442\u0430","text":"<pre><code>personal-account/\n\u251c\u2500\u2500 app/\n\u2502   \u251c\u2500\u2500 core/           # \u0411\u0435\u0437\u043e\u043f\u0430\u0441\u043d\u043e\u0441\u0442\u044c, JWT\n\u2502   \u251c\u2500\u2500 routers/        # API endpoints\n\u2502   \u251c\u2500\u2500 services/       # \u0411\u0438\u0437\u043d\u0435\u0441-\u043b\u043e\u0433\u0438\u043a\u0430\n\u2502   \u251c\u2500\u2500 repositories/   # \u0421\u043b\u043e\u0439 \u0434\u0430\u043d\u043d\u044b\u0445\n\u2502   \u251c\u2500\u2500 schemas/        # Pydantic \u043c\u043e\u0434\u0435\u043b\u0438\n\u2502   \u251c\u2500\u2500 config.py       # \u041a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044f\n\u2502   \u2514\u2500\u2500 database.py     # \u041f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435 \u043a \u0411\u0414\n\u251c\u2500\u2500 main.py             # \u0422\u043e\u0447\u043a\u0430 \u0432\u0445\u043e\u0434\u0430 FastAPI\n\u2514\u2500\u2500 mkdocs.yml          # \u041a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044f \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430\u0446\u0438\u0438\n</code></pre>"},{"location":"#_4","title":"\u041d\u0430\u0432\u0438\u0433\u0430\u0446\u0438\u044f","text":"<ul> <li>\u0410\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u0430 \u2014 \u043e\u0431\u0437\u043e\u0440 \u0430\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u044b \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u044f</li> <li>API Reference \u2014 \u0441\u043f\u0440\u0430\u0432\u043e\u0447\u043d\u0438\u043a \u043f\u043e \u0432\u0441\u0435\u043c \u043c\u043e\u0434\u0443\u043b\u044f\u043c</li> </ul>"},{"location":"#_5","title":"\u0422\u0435\u0445\u043d\u043e\u043b\u043e\u0433\u0438\u0438","text":"\u0422\u0435\u0445\u043d\u043e\u043b\u043e\u0433\u0438\u044f \u041d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 FastAPI Web framework Pydantic \u0412\u0430\u043b\u0438\u0434\u0430\u0446\u0438\u044f \u0434\u0430\u043d\u043d\u044b\u0445 PostgreSQL \u0411\u0430\u0437\u0430 \u0434\u0430\u043d\u043d\u044b\u0445 Keycloak \u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f OAuth2/OIDC OpenTelemetry \u0422\u0440\u0430\u0441\u0441\u0438\u0440\u043e\u0432\u043a\u0430 \u0438 \u043c\u0435\u0442\u0440\u0438\u043a\u0438"},{"location":"architecture/","title":"\u0410\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u0430","text":""},{"location":"architecture/#_2","title":"\u041e\u0431\u0437\u043e\u0440","text":"<p>Personal Account \u043f\u043e\u0441\u0442\u0440\u043e\u0435\u043d \u043f\u043e \u043f\u0440\u0438\u043d\u0446\u0438\u043f\u0443 \u0442\u0440\u0451\u0445\u0441\u043b\u043e\u0439\u043d\u043e\u0439 \u0430\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u044b:</p> <pre><code>graph TD\n    A[Client] --&gt; B[Nginx Reverse Proxy]\n    B --&gt; C[FastAPI Application]\n    C --&gt; D[Routers Layer]\n    D --&gt; E[Services Layer]\n    E --&gt; F[Repositories Layer]\n    F --&gt; G[(PostgreSQL)]\n    C --&gt; H[Keycloak]</code></pre>"},{"location":"architecture/#_3","title":"\u0421\u043b\u043e\u0438 \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u044f","text":""},{"location":"architecture/#1-routers-presentation-layer","title":"1. Routers (Presentation Layer)","text":"<p>\u041e\u0442\u0432\u0435\u0447\u0430\u044e\u0442 \u0437\u0430:</p> <ul> <li>\u041e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u0438\u0435 HTTP endpoints</li> <li>\u0412\u0430\u043b\u0438\u0434\u0430\u0446\u0438\u044f \u0432\u0445\u043e\u0434\u043d\u044b\u0445 \u0434\u0430\u043d\u043d\u044b\u0445 \u0447\u0435\u0440\u0435\u0437 Pydantic</li> <li>\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f \u0447\u0435\u0440\u0435\u0437 JWT \u0442\u043e\u043a\u0435\u043d\u044b</li> <li>\u0424\u043e\u0440\u043c\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 HTTP \u043e\u0442\u0432\u0435\u0442\u043e\u0432</li> </ul> <p>\u041c\u043e\u0434\u0443\u043b\u0438: <code>app.routers.*</code></p>"},{"location":"architecture/#2-services-business-logic-layer","title":"2. Services (Business Logic Layer)","text":"<p>\u041e\u0442\u0432\u0435\u0447\u0430\u044e\u0442 \u0437\u0430:</p> <ul> <li>\u0411\u0438\u0437\u043d\u0435\u0441-\u043b\u043e\u0433\u0438\u043a\u0443</li> <li>\u041e\u0440\u043a\u0435\u0441\u0442\u0440\u0430\u0446\u0438\u044e \u0432\u044b\u0437\u043e\u0432\u043e\u0432 \u0440\u0435\u043f\u043e\u0437\u0438\u0442\u043e\u0440\u0438\u0435\u0432</li> <li>\u0422\u0440\u0430\u043d\u0441\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044e \u0434\u0430\u043d\u043d\u044b\u0445</li> <li>\u041e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0443 \u043e\u0448\u0438\u0431\u043e\u043a</li> </ul> <p>\u041c\u043e\u0434\u0443\u043b\u0438: <code>app.services.*</code></p>"},{"location":"architecture/#3-repositories-data-access-layer","title":"3. Repositories (Data Access Layer)","text":"<p>\u041e\u0442\u0432\u0435\u0447\u0430\u044e\u0442 \u0437\u0430:</p> <ul> <li>CRUD \u043e\u043f\u0435\u0440\u0430\u0446\u0438\u0438 \u0441 \u0411\u0414</li> <li>SQL \u0437\u0430\u043f\u0440\u043e\u0441\u044b</li> <li>\u041c\u0430\u043f\u043f\u0438\u043d\u0433 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u043e\u0432</li> </ul> <p>\u041c\u043e\u0434\u0443\u043b\u0438: <code>app.repositories.*</code></p>"},{"location":"architecture/#_4","title":"\u0411\u0435\u0437\u043e\u043f\u0430\u0441\u043d\u043e\u0441\u0442\u044c","text":""},{"location":"architecture/#jwt","title":"JWT \u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f","text":"<pre><code>sequenceDiagram\n    participant Client\n    participant Nginx\n    participant FastAPI\n    participant Keycloak\n\n    Client-&gt;&gt;Keycloak: POST /token (credentials)\n    Keycloak--&gt;&gt;Client: JWT Access Token\n    Client-&gt;&gt;Nginx: Request + Bearer Token\n    Nginx-&gt;&gt;FastAPI: Proxy request\n    FastAPI-&gt;&gt;FastAPI: Validate JWT (JWKS)\n    FastAPI--&gt;&gt;Client: Response</code></pre> <p>\u041a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442\u044b:</p> <ul> <li><code>app.core.security</code> \u2014 \u0432\u0430\u043b\u0438\u0434\u0430\u0446\u0438\u044f \u0442\u043e\u043a\u0435\u043d\u043e\u0432</li> <li><code>app.core.jwt</code> \u2014 \u0440\u0430\u0431\u043e\u0442\u0430 \u0441 JWKS</li> </ul>"},{"location":"architecture/#observability","title":"Observability","text":""},{"location":"architecture/#opentelemetry","title":"OpenTelemetry","text":"<p>\u041f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u0435 \u0438\u043d\u0441\u0442\u0440\u0443\u043c\u0435\u043d\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u043e \u0434\u043b\u044f:</p> <ul> <li>\u0422\u0440\u0430\u0441\u0441\u0438\u0440\u043e\u0432\u043a\u0438 \u2014 \u0440\u0430\u0441\u043f\u0440\u0435\u0434\u0435\u043b\u0451\u043d\u043d\u044b\u0435 trace \u0447\u0435\u0440\u0435\u0437 Jaeger</li> <li>\u041b\u043e\u0433\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u2014 \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0435 \u043b\u043e\u0433\u0438 \u0441 trace_id</li> <li>\u041c\u0435\u0442\u0440\u0438\u043a \u2014 \u0447\u0435\u0440\u0435\u0437 OTEL Collector</li> </ul> <p>\u041a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044f: <code>app.telemetry_config</code></p>"},{"location":"architecture/#_5","title":"\u041a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044f","text":"<p>\u0412\u0441\u0435 \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 \u0447\u0435\u0440\u0435\u0437 \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u0435 \u043e\u043a\u0440\u0443\u0436\u0435\u043d\u0438\u044f \u0438 <code>.env</code> \u0444\u0430\u0439\u043b.</p> <p>\u0421\u043c. <code>app.config.Settings</code> \u0434\u043b\u044f \u043f\u043e\u043b\u043d\u043e\u0433\u043e \u0441\u043f\u0438\u0441\u043a\u0430 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u043e\u0432.</p>"},{"location":"api/","title":"API Reference","text":"<p>\u0421\u043f\u0440\u0430\u0432\u043e\u0447\u043d\u0438\u043a \u043f\u043e \u0432\u0441\u0435\u043c \u043c\u043e\u0434\u0443\u043b\u044f\u043c Personal Account API.</p>"},{"location":"api/#_1","title":"\u0421\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0430","text":""},{"location":"api/#routers-endpoints","title":"Routers (Endpoints)","text":"<p>HTTP endpoints \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u044f:</p> <ul> <li>Students \u2014 \u0443\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0441\u0442\u0443\u0434\u0435\u043d\u0442\u0430\u043c\u0438</li> <li>Certificates \u2014 \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u044b</li> <li>Visits \u2014 \u043f\u043e\u0441\u0435\u0449\u0430\u0435\u043c\u043e\u0441\u0442\u044c</li> <li>Auth \u2014 \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f</li> <li>Health \u2014 health checks</li> </ul>"},{"location":"api/#services-business-logic","title":"Services (Business Logic)","text":"<p>\u0411\u0438\u0437\u043d\u0435\u0441-\u043b\u043e\u0433\u0438\u043a\u0430:</p> <ul> <li>Student Service</li> <li>Certificate Service</li> <li>Visit Service</li> <li>Auth Service</li> <li>Keycloak Service</li> </ul>"},{"location":"api/#core-infrastructure","title":"Core (Infrastructure)","text":"<p>\u0418\u043d\u0444\u0440\u0430\u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u043d\u044b\u0435 \u043a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442\u044b:</p> <ul> <li>Security \u2014 JWT \u0432\u0430\u043b\u0438\u0434\u0430\u0446\u0438\u044f</li> <li>JWT \u2014 \u0440\u0430\u0431\u043e\u0442\u0430 \u0441 \u0442\u043e\u043a\u0435\u043d\u0430\u043c\u0438</li> </ul>"},{"location":"api/#schemas-data-models","title":"Schemas (Data Models)","text":"<p>Pydantic \u043c\u043e\u0434\u0435\u043b\u0438:</p> <ul> <li>Student</li> <li>Certificate</li> <li>Visit</li> <li>Common \u2014 \u043e\u0431\u0449\u0438\u0435 \u0441\u0445\u0435\u043c\u044b</li> </ul>"},{"location":"api/#repositories-data-access","title":"Repositories (Data Access)","text":"<p>\u0421\u043b\u043e\u0439 \u0434\u043e\u0441\u0442\u0443\u043f\u0430 \u043a \u0434\u0430\u043d\u043d\u044b\u043c:</p> <ul> <li>Base Repository</li> <li>Student Repository</li> </ul>"},{"location":"api/#other","title":"Other","text":"<ul> <li>Database \u2014 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435 \u043a \u0411\u0414</li> <li>Config \u2014 \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044f</li> <li>Telemetry \u2014 \u0442\u0440\u0430\u0441\u0441\u0438\u0440\u043e\u0432\u043a\u0430</li> </ul>"},{"location":"api/config/","title":"\u041a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044f","text":"<p>\u041d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u044f \u0447\u0435\u0440\u0435\u0437 Pydantic Settings.</p>"},{"location":"api/config/#_2","title":"\u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435","text":"<ul> <li>\u041f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u0435 \u043e\u043a\u0440\u0443\u0436\u0435\u043d\u0438\u044f</li> <li>URL \u0411\u0414, Keycloak</li> <li>\u041e\u043f\u0446\u0438\u0438 \u0442\u0435\u043b\u0435\u043c\u0435\u0442\u0440\u0438\u0438</li> </ul>"},{"location":"api/config/#api-reference","title":"API Reference","text":"<p>Application configuration.</p>"},{"location":"api/config/#app.config-classes","title":"Classes","text":""},{"location":"api/config/#app.config.settings","title":"settings","text":"<pre><code>settings()\n</code></pre> <p>Application settings loaded from environment variables.</p> Source code in <code>app/config.py</code> <pre><code>def __init__(self):\n    self.DATABASE_HOST: str = os.getenv(\"DATABASE_HOST\", \"app-db\")\n    self.DATABASE_PORT: int = int(os.getenv(\"DATABASE_PORT\", \"5432\"))\n    self.DATABASE_NAME: str = os.getenv(\"DATABASE_NAME\", \"appdb\")\n    self.DATABASE_USER: str = os.getenv(\"DATABASE_USER\", \"appuser\")\n    self.DATABASE_PASSWORD: str = os.getenv(\"DATABASE_PASSWORD\", \"password\")\n    self.DATABASE_POOL_MIN_SIZE: int = int(os.getenv(\"DATABASE_POOL_MIN_SIZE\", \"5\"))\n    self.DATABASE_POOL_MAX_SIZE: int = int(os.getenv(\"DATABASE_POOL_MAX_SIZE\", \"20\"))\n\n    self.DEBUG: bool = os.getenv(\"DEBUG\", \"false\").lower() == \"true\"\n    self.API_PREFIX: str = os.getenv(\"API_PREFIX\", \"/api/v1\")\n\n   # \u041f\u0423\u0411\u041b\u0418\u0427\u041d\u042f \u0427\u0410\u0421\u0422\u042c \u0411\u0423\u0414\u0415\u0422 \u041f\u041e\u0422\u041e\u041c :)\n    self.API_PUBLIC_URL: str = os.getenv(\"API_PUBLIC_URL\", \"http://localhost:8004\")\n\n    # Observability / OpenTelemetry - Core\n    self.OTEL_EXPORTER_OTLP_ENDPOINT: str = os.getenv(\n        \"OTEL_EXPORTER_OTLP_ENDPOINT\",\n        \"http://otel-collector:4317\",\n    )\n    self.OTEL_SERVICE_NAME: str = os.getenv(\n        \"OTEL_SERVICE_NAME\",\n        \"personal-account-api\",\n    )\n    self.OTEL_EXPORTER_OTLP_INSECURE: bool = (\n        os.getenv(\"OTEL_EXPORTER_OTLP_INSECURE\", \"true\").lower() == \"true\"\n    )\n\n    # OpenTelemetry - Sampling\n    self.OTEL_SAMPLING_RATE: str = os.getenv(\"OTEL_TRACES_SAMPLER_ARG\", \"1.0\")  # 1.0 = 100%\n\n    # OpenTelemetry - Span Limits\n    self.OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT: str = os.getenv(\"OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT\", \"128\")\n    self.OTEL_SPAN_EVENT_COUNT_LIMIT: str = os.getenv(\"OTEL_SPAN_EVENT_COUNT_LIMIT\", \"128\")\n    self.OTEL_SPAN_LINK_COUNT_LIMIT: str = os.getenv(\"OTEL_SPAN_LINK_COUNT_LIMIT\", \"128\")\n    self.OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT: str = os.getenv(\"OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT\", \"4096\")\n\n    # OpenTelemetry - Export Configuration\n    self.OTEL_EXPORTER_OTLP_TIMEOUT: str = os.getenv(\"OTEL_EXPORTER_OTLP_TIMEOUT\", \"30000\")  # ms\n    self.OTEL_BSP_MAX_EXPORT_BATCH_SIZE: str = os.getenv(\"OTEL_BSP_MAX_EXPORT_BATCH_SIZE\", \"512\")\n    self.OTEL_BSP_SCHEDULE_DELAY: str = os.getenv(\"OTEL_BSP_SCHEDULE_DELAY\", \"5000\")  # ms\n    self.OTEL_BSP_MAX_QUEUE_SIZE: str = os.getenv(\"OTEL_BSP_MAX_QUEUE_SIZE\", \"2048\")\n\n    # OpenTelemetry - Feature Flags\n    self.OTEL_ENABLE_CONSOLE_EXPORTER: bool = os.getenv(\"OTEL_ENABLE_CONSOLE_EXPORTER\", \"false\").lower() == \"true\"\n    self.OTEL_ENABLE_LOGGING: bool = os.getenv(\"OTEL_ENABLE_LOGGING\", \"true\").lower() == \"true\"\n    self.OTEL_ENABLE_SQLALCHEMY: bool = os.getenv(\"OTEL_ENABLE_SQLALCHEMY\", \"true\").lower() == \"true\"\n    self.OTEL_ENABLE_HTTPX: bool = os.getenv(\"OTEL_ENABLE_HTTPX\", \"true\").lower() == \"true\"\n    self.OTEL_EXCLUDED_URLS: str = os.getenv(\"OTEL_EXCLUDED_URLS\", \"/health,/metrics\")\n\n    # Service metadata\n    self.SERVICE_VERSION: str = os.getenv(\"SERVICE_VERSION\", \"1.0.0\")\n    self.SERVICE_NAMESPACE: str = os.getenv(\"SERVICE_NAMESPACE\", \"lms-tages\")\n    self.SERVICE_INSTANCE_ID: str = os.getenv(\"SERVICE_INSTANCE_ID\", \"unknown\")\n    self.ENVIRONMENT: str = os.getenv(\"ENVIRONMENT\", \"production\")\n\n    # Keycloak Authentication\n    self.KEYCLOAK_SERVER_URL: str = os.getenv(\"KEYCLOAK_SERVER_URL\", \"http://keycloak:8080\")\n    self.KEYCLOAK_PUBLIC_URL: str = os.getenv(\"KEYCLOAK_PUBLIC_URL\", \"http://localhost:8080\")\n    self.KEYCLOAK_REALM: str = os.getenv(\"KEYCLOAK_REALM\", \"student\")\n    self.KEYCLOAK_ADMIN_REALM: str = os.getenv(\"KEYCLOAK_ADMIN_REALM\", \"teacher\")\n    self.KEYCLOAK_CLIENT_ID: str = os.getenv(\"KEYCLOAK_CLIENT_ID\", \"personal-account-client\")\n    self.KEYCLOAK_CLIENT_SECRET: str = os.getenv(\"KEYCLOAK_CLIENT_SECRET\", \"secret\")\n    self.KEYCLOAK_REDIRECT_URI: str = os.getenv(\"KEYCLOAK_REDIRECT_URI\", \"http://localhost/account/callback\")\n\n    # Keycloak Admin credentials (for user registration)\n    self.KEYCLOAK_ADMIN_USERNAME: str = os.getenv(\"KEYCLOAK_ADMIN_USERNAME\", \"admin\")\n    self.KEYCLOAK_ADMIN_PASSWORD: str = os.getenv(\"KEYCLOAK_ADMIN_PASSWORD\", \"admin\")\n\n    self.KEYCLOAK_DEFAULT_SCOPE: str = os.getenv(\n        \"KEYCLOAK_DEFAULT_SCOPE\", \"openid profile email\"\n    )\n    self.KEYCLOAK_USER_EMAIL_VERIFIED_DEFAULT: bool = (\n        os.getenv(\"KEYCLOAK_USER_EMAIL_VERIFIED_DEFAULT\", \"true\").lower() == \"true\"\n    )\n</code></pre>"},{"location":"api/config/#app.config.settings-attributes","title":"Attributes","text":""},{"location":"api/config/#app.config.settings.database_url","title":"database_url  <code>property</code>","text":"<pre><code>database_url: str\n</code></pre> <p>Construct database URL.</p>"},{"location":"api/config/#app.config-functions","title":"Functions","text":""},{"location":"api/config/#app.config.get_settings","title":"get_settings  <code>cached</code>","text":"<pre><code>get_settings() -&gt; settings\n</code></pre> <p>Get cached settings instance.</p> Source code in <code>app/config.py</code> <pre><code>@lru_cache()\ndef get_settings() -&gt; settings:\n    \"\"\"Get cached settings instance.\"\"\"\n    return settings()\n</code></pre>"},{"location":"api/database/","title":"\u0411\u0430\u0437\u0430 \u0434\u0430\u043d\u043d\u044b\u0445","text":"<p>\u041f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435 \u0438 \u0441\u0435\u0441\u0441\u0438\u0438 SQLAlchemy.</p>"},{"location":"api/database/#_2","title":"\u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435","text":"<ul> <li>AsyncEngine</li> <li>AsyncSession</li> <li>Dependency \u0434\u043b\u044f FastAPI</li> </ul>"},{"location":"api/database/#api-reference","title":"API Reference","text":"<p>Database connection management using SQLAlchemy Core (async).</p>"},{"location":"api/database/#app.database-functions","title":"Functions","text":""},{"location":"api/database/#app.database.init_db_pool","title":"init_db_pool  <code>async</code>","text":"<pre><code>init_db_pool() -&gt; None\n</code></pre> <p>Initialize SQLAlchemy async engine.</p> Source code in <code>app/database.py</code> <pre><code>async def init_db_pool() -&gt; None:\n    \"\"\"Initialize SQLAlchemy async engine.\"\"\"\n    global _engine, _sqlalchemy_instrumented\n\n    settings = get_settings()\n    async_url = _build_async_url(settings.database_url)\n    _engine = create_async_engine(\n        async_url,\n        pool_size=settings.DATABASE_POOL_MIN_SIZE,\n        max_overflow=max(0, settings.DATABASE_POOL_MAX_SIZE - settings.DATABASE_POOL_MIN_SIZE),\n        echo=settings.DEBUG,\n    )\n    if not _sqlalchemy_instrumented:\n        SQLAlchemyInstrumentor().instrument(engine=_engine.sync_engine)\n        _sqlalchemy_instrumented = True\n    logger.info(\"SQLAlchemy async engine initialized\")\n</code></pre>"},{"location":"api/database/#app.database.close_db_pool","title":"close_db_pool  <code>async</code>","text":"<pre><code>close_db_pool() -&gt; None\n</code></pre> <p>Dispose SQLAlchemy engine.</p> Source code in <code>app/database.py</code> <pre><code>async def close_db_pool() -&gt; None:\n    \"\"\"Dispose SQLAlchemy engine.\"\"\"\n    global _engine\n    if _engine:\n        await _engine.dispose()\n        _engine = None\n        logger.info(\"SQLAlchemy async engine disposed\")\n</code></pre>"},{"location":"api/telemetry/","title":"\u0422\u0435\u043b\u0435\u043c\u0435\u0442\u0440\u0438\u044f","text":"<p>OpenTelemetry \u0442\u0440\u0435\u0439\u0441\u0438\u043d\u0433 \u0438 \u043c\u0435\u0442\u0440\u0438\u043a\u0438.</p>"},{"location":"api/telemetry/#_2","title":"\u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435","text":"<ul> <li>Jaeger \u0438\u043d\u0442\u0435\u0433\u0440\u0430\u0446\u0438\u044f</li> <li>\u0422\u0440\u0435\u0439\u0441\u0438\u043d\u0433 HTTP \u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432</li> <li>\u041b\u043e\u0433\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435</li> </ul>"},{"location":"api/telemetry/#api-reference","title":"API Reference","text":"<p>Telemetry helpers for tracing application code.</p>"},{"location":"api/telemetry/#app.telemetry-functions","title":"Functions","text":""},{"location":"api/telemetry/#app.telemetry.traced","title":"traced","text":"<pre><code>traced(span_name: str | None = None, *, record_args: bool = True, record_result: bool = True) -&gt; Callable[[Callable[P, T]], Callable[P, T]]\n</code></pre> <p>Decorator for adding OpenTelemetry spans around sync/async callables.</p>"},{"location":"api/telemetry/#app.telemetry.traced--parameters","title":"Parameters","text":"<p>span_name : str | None     Custom span name. Defaults to function qualified name. record_args : bool     Whether to record function arguments as span attributes. record_result : bool     Whether to record function return value as span attribute.</p> Source code in <code>app/telemetry.py</code> <pre><code>def traced(\n    span_name: str | None = None,\n    *,\n    record_args: bool = True,\n    record_result: bool = True,\n) -&gt; Callable[[Callable[P, T]], Callable[P, T]]:\n    \"\"\"\n    Decorator for adding OpenTelemetry spans around sync/async callables.\n\n    Parameters\n    ----------\n    span_name : str | None\n        Custom span name. Defaults to function qualified name.\n    record_args : bool\n        Whether to record function arguments as span attributes.\n    record_result : bool\n        Whether to record function return value as span attribute.\n    \"\"\"\n\n    def decorator(func: Callable[P, T]) -&gt; Callable[P, T]:\n        name = span_name or func.__qualname__\n\n        if inspect.iscoroutinefunction(func):\n\n            @wraps(func)\n            async def async_wrapper(*args: P.args, **kwargs: P.kwargs) -&gt; T:\n                with _tracer.start_as_current_span(name) as span:\n                    _attach_code_attributes(span, func)\n                    if record_args:\n                        _attach_args(span, func, args, kwargs)\n                    try:\n                        result = await func(*args, **kwargs)\n                        if record_result:\n                            _attach_result(span, result)\n                        span.set_status(StatusCode.OK)\n                        return result\n                    except Exception as exc:\n                        _attach_exception(span, exc)\n                        raise\n\n            return async_wrapper\n\n        @wraps(func)\n        def sync_wrapper(*args: P.args, **kwargs: P.kwargs) -&gt; T:\n            with _tracer.start_as_current_span(name) as span:\n                _attach_code_attributes(span, func)\n                if record_args:\n                    _attach_args(span, func, args, kwargs)\n                try:\n                    result = func(*args, **kwargs)\n                    if record_result:\n                        _attach_result(span, result)\n                    span.set_status(StatusCode.OK)\n                    return result\n                except Exception as exc:\n                    _attach_exception(span, exc)\n                    raise\n\n        return sync_wrapper\n\n    return decorator\n</code></pre>"},{"location":"api/telemetry/#app.telemetry.get_tracer","title":"get_tracer","text":"<pre><code>get_tracer() -&gt; trace.Tracer\n</code></pre> <p>Expose module tracer for advanced scenarios.</p> Source code in <code>app/telemetry.py</code> <pre><code>def get_tracer() -&gt; trace.Tracer:\n    \"\"\"Expose module tracer for advanced scenarios.\"\"\"\n    return _tracer\n</code></pre>"},{"location":"api/core/jwt/","title":"JWT","text":"<p>\u0420\u0430\u0431\u043e\u0442\u0430 \u0441 JWT \u0442\u043e\u043a\u0435\u043d\u0430\u043c\u0438.</p>"},{"location":"api/core/jwt/#_1","title":"\u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435","text":"<p>\u0424\u0443\u043d\u043a\u0446\u0438\u0438 \u0434\u043b\u044f:</p> <ul> <li>\u0414\u0435\u043a\u043e\u0434\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u0442\u043e\u043a\u0435\u043d\u043e\u0432</li> <li>\u0418\u0437\u0432\u043b\u0435\u0447\u0435\u043d\u0438\u044f claims</li> <li>\u0412\u0430\u043b\u0438\u0434\u0430\u0446\u0438\u0438</li> </ul>"},{"location":"api/core/jwt/#api-reference","title":"API Reference","text":"<p>JWT helper: decode/validate (JWKS) and optional encode for internal tokens.</p>"},{"location":"api/core/jwt/#app.core.jwt-classes","title":"Classes","text":""},{"location":"api/core/jwt/#app.core.jwt.JwtService","title":"JwtService","text":"<pre><code>JwtService(keycloak_url: str, realm: str)\n</code></pre> Source code in <code>app/core/jwt.py</code> <pre><code>def __init__(self, keycloak_url: str, realm: str):\n    self.keycloak_url = keycloak_url.rstrip(\"/\")\n    self.realm = realm\n    self._jwks_cache: Optional[Dict[str, Any]] = None\n    self._jwks_time: Optional[float] = None\n    self._jwks_ttl = 3600  # seconds\n</code></pre>"},{"location":"api/core/jwt/#app.core.jwt.JwtService-functions","title":"Functions","text":""},{"location":"api/core/jwt/#app.core.jwt.JwtService.decode","title":"decode  <code>async</code>","text":"<pre><code>decode(token: str, audience: Optional[str] = None, issuer: Optional[str] = None) -&gt; Dict[str, Any]\n</code></pre> <p>Validate and decode token using JWKS. Returns payload dict or raises JWTError/ExpiredSignatureError.</p> Source code in <code>app/core/jwt.py</code> <pre><code>async def decode(self, token: str, audience: Optional[str] = None, issuer: Optional[str] = None) -&gt; Dict[str, Any]:\n    \"\"\"\n    Validate and decode token using JWKS. Returns payload dict or raises JWTError/ExpiredSignatureError.\n    \"\"\"\n    jwks = await self._fetch_jwks()\n    # jose accepts jwks directly as key (works like before)\n    return jwt.decode(\n        token,\n        jwks,\n        algorithms=[\"RS256\"],\n        audience=audience,\n        issuer=issuer,\n        options={\"verify_exp\": True}\n    )\n</code></pre>"},{"location":"api/core/jwt/#app.core.jwt.JwtService.encode","title":"encode","text":"<pre><code>encode(payload: Dict[str, Any], private_key_pem: str, algorithm: str = 'RS256', expires_in: Optional[int] = None) -&gt; str\n</code></pre> <p>Encode internal token (only if you control signing key). Use this only for internal tokens, not to fake Keycloak tokens. private_key_pem must be stored securely.</p> Source code in <code>app/core/jwt.py</code> <pre><code>def encode(self, payload: Dict[str, Any], private_key_pem: str, algorithm: str = \"RS256\", expires_in: Optional[int] = None) -&gt; str:\n    \"\"\"\n    Encode internal token (only if you control signing key). Use this only for internal tokens,\n    not to fake Keycloak tokens. private_key_pem must be stored securely.\n    \"\"\"\n    data = payload.copy()\n    now = int(time.time())\n    if expires_in:\n        data.setdefault(\"iat\", now)\n        data.setdefault(\"exp\", now + expires_in)\n    return jwt.encode(data, private_key_pem, algorithm=algorithm)\n</code></pre>"},{"location":"api/core/security/","title":"\u0411\u0435\u0437\u043e\u043f\u0430\u0441\u043d\u043e\u0441\u0442\u044c","text":"<p>\u041c\u043e\u0434\u0443\u043b\u044c \u0430\u0443\u0442\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u0438 \u0438 \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u0438.</p>"},{"location":"api/core/security/#_2","title":"\u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435","text":"<p>\u0421\u043e\u0434\u0435\u0440\u0436\u0438\u0442:</p> <ul> <li>OAuth2 \u0441\u0445\u0435\u043c\u0443 \u0434\u043b\u044f Swagger UI</li> <li>\u0417\u0430\u0432\u0438\u0441\u0438\u043c\u043e\u0441\u0442\u044c \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0438 \u0442\u043e\u043a\u0435\u043d\u043e\u0432</li> <li>\u0418\u0437\u0432\u043b\u0435\u0447\u0435\u043d\u0438\u0435 \u0434\u0430\u043d\u043d\u044b\u0445 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f</li> </ul>"},{"location":"api/core/security/#api-reference","title":"API Reference","text":"<p>JWT security and token validation.</p>"},{"location":"api/core/security/#app.core.security-classes","title":"Classes","text":""},{"location":"api/core/security/#app.core.security.TokenPayload","title":"TokenPayload","text":"<p>               Bases: <code>BaseModel</code></p> <p>JWT token payload from Keycloak.</p>"},{"location":"api/core/security/#app.core.security.JWTValidator","title":"JWTValidator","text":"<pre><code>JWTValidator(keycloak_url: str, realm: str, client_id: str)\n</code></pre> <p>Validate JWT tokens using Keycloak JWKS.</p> Source code in <code>app/core/security.py</code> <pre><code>def __init__(self, keycloak_url: str, realm: str, client_id: str):\n    self.client_id = client_id\n    self.issuer = f\"{keycloak_url.rstrip('/')}/realms/{realm}\"\n</code></pre>"},{"location":"api/core/security/#app.core.security.JWTValidator-functions","title":"Functions","text":""},{"location":"api/core/security/#app.core.security.JWTValidator.validate_token","title":"validate_token  <code>async</code>","text":"<pre><code>validate_token(token: str) -&gt; TokenPayload\n</code></pre> <p>Validate JWT token and extract payload.</p> <p>Parameters:</p> Name Type Description Default <code>token</code> <code>str</code> <p>JWT token string</p> required <p>Returns:</p> Type Description <code>TokenPayload</code> <p>TokenPayload with user data</p> <p>Raises:</p> Type Description <code>HTTPException</code> <p>If token is invalid or expired</p> Source code in <code>app/core/security.py</code> <pre><code>@traced(\"jwt_validator.validate_token\", record_args=True, record_result=True)\nasync def validate_token(self, token: str) -&gt; TokenPayload:\n    \"\"\"\n    Validate JWT token and extract payload.\n\n    Args:\n        token: JWT token string\n\n    Returns:\n        TokenPayload with user data\n\n    Raises:\n        HTTPException: If token is invalid or expired\n    \"\"\"\n    try:\n        payload = await _jwt_service.decode(token, audience=\"account\", issuer=self.issuer)\n        # extract roles as before\n        roles = []\n        if isinstance(payload, dict):\n            realm_access = payload.get(\"realm_access\")\n            if isinstance(realm_access, dict):\n                roles = realm_access.get(\"roles\", []) or []\n            # fallback: some setups may put roles directly\n            if not roles:\n                roles = payload.get(\"roles\", []) or []\n\n            # ensure serializable list\n            payload[\"roles\"] = list(roles)\n        # \u041f\u0440\u0435\u043e\u0431\u0440\u0430\u0437\u0443\u0435\u043c \u0432 \u0442\u0438\u043f\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043e\u0431\u044a\u0435\u043a\u0442\n        token_payload = TokenPayload(**payload)\n\n        logger.info(\n            f\"Token validated successfully for user {token_payload.sub}\"\n        )\n        return token_payload\n\n    except ExpiredSignatureError:\n        logger.warning(\"JWT token has expired\")\n        raise HTTPException(\n            status_code=status.HTTP_401_UNAUTHORIZED,\n            detail=\"Token has expired\",\n            headers={\"WWW-Authenticate\": \"Bearer\"}\n        )\n    except JWTError as e:\n        logger.warning(f\"JWT validation failed: {e}\")\n        raise HTTPException(\n            status_code=status.HTTP_401_UNAUTHORIZED,\n            detail=\"Invalid token\",\n            headers={\"WWW-Authenticate\": \"Bearer\"}\n        )\n    except Exception as e:\n        logger.error(f\"Unexpected error during token validation: {e}\")\n        raise HTTPException(\n            status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n            detail=\"Token validation error\"\n        )\n</code></pre>"},{"location":"api/core/security/#app.core.security-functions","title":"Functions","text":""},{"location":"api/core/security/#app.core.security.get_current_user","title":"get_current_user  <code>async</code>","text":"<pre><code>get_current_user(request: Request, credentials: Optional[HTTPAuthorizationCredentials] = Depends(security)) -&gt; TokenPayload\n</code></pre> <p>Get current authenticated user from JWT token.</p> <p>\u042d\u0442\u043e\u0442 dependency \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0432 \u0437\u0430\u0449\u0438\u0449\u0451\u043d\u043d\u044b\u0445 \u0440\u043e\u0443\u0442\u0430\u0445:</p> <pre><code>@router.get(\"/me\")\nasync def get_me(current_user: TokenPayload = Depends(get_current_user)):\n    return {\"user\": current_user}\n</code></pre> Source code in <code>app/core/security.py</code> <pre><code>@traced(\"security.get_current_user\", record_result=False)\nasync def get_current_user(\n    request: Request,\n    credentials: Optional[HTTPAuthorizationCredentials] = Depends(security),\n) -&gt; TokenPayload:\n    \"\"\"\n    Get current authenticated user from JWT token.\n\n    \u042d\u0442\u043e\u0442 dependency \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0432 \u0437\u0430\u0449\u0438\u0449\u0451\u043d\u043d\u044b\u0445 \u0440\u043e\u0443\u0442\u0430\u0445:\n\n    ```python\n    @router.get(\"/me\")\n    async def get_me(current_user: TokenPayload = Depends(get_current_user)):\n        return {\"user\": current_user}\n    ```\n    \"\"\"\n    token = None\n\n    # Prefer Authorization header if present\n    if credentials and credentials.credentials:\n        token = credentials.credentials\n\n    # Fallback to HttpOnly cookie set by the callback endpoint\n    if not token:\n        cookie_token = request.cookies.get(\"access_token\")\n        if cookie_token:\n            token = cookie_token\n\n    if not token:\n        raise HTTPException(\n            status_code=status.HTTP_401_UNAUTHORIZED,\n            detail=\"Not authenticated\",\n            headers={\"WWW-Authenticate\": \"Bearer\"}\n        )\n\n    return await _jwt_validator.validate_token(token)\n</code></pre>"},{"location":"api/core/security/#app.core.security.get_current_user_optional","title":"get_current_user_optional  <code>async</code>","text":"<pre><code>get_current_user_optional(request: Request, credentials: Optional[HTTPAuthorizationCredentials] = Depends(security)) -&gt; Optional[TokenPayload]\n</code></pre> <p>Get current user if authenticated, otherwise return None.</p> <p>\u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0434\u043b\u044f \u043e\u043f\u0446\u0438\u043e\u043d\u0430\u043b\u044c\u043d\u043e\u0439 \u0430\u0443\u0442\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u0438.</p> Source code in <code>app/core/security.py</code> <pre><code>@traced(\"security.get_current_user_optional\", record_result=False)\nasync def get_current_user_optional(\n    request: Request,\n    credentials: Optional[HTTPAuthorizationCredentials] = Depends(security),\n) -&gt; Optional[TokenPayload]:\n    \"\"\"\n    Get current user if authenticated, otherwise return None.\n\n    \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0434\u043b\u044f \u043e\u043f\u0446\u0438\u043e\u043d\u0430\u043b\u044c\u043d\u043e\u0439 \u0430\u0443\u0442\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u0438.\n    \"\"\"\n    token = None\n\n    if credentials and credentials.credentials:\n        token = credentials.credentials\n\n    if not token:\n        token = request.cookies.get(\"access_token\")\n\n    if not token:\n        return None\n\n    try:\n        return await _jwt_validator.validate_token(token)\n    except HTTPException:\n        # If token invalid, return None\n        return None\n</code></pre>"},{"location":"api/core/security/#app.core.security.require_roles","title":"require_roles","text":"<pre><code>require_roles(*roles: str)\n</code></pre> <p>Create a dependency that requires specific roles.</p> <pre><code>@router.get(\"/admin\")\nasync def admin_only(\n    current_user: TokenPayload = Depends(get_current_user),\n    _: None = Depends(require_roles(\"admin\"))\n):\n    return {\"message\": \"Admin only\"}\n</code></pre> Source code in <code>app/core/security.py</code> <pre><code>def require_roles(*roles: str):\n    \"\"\"\n    Create a dependency that requires specific roles.\n\n    ```python\n    @router.get(\"/admin\")\n    async def admin_only(\n        current_user: TokenPayload = Depends(get_current_user),\n        _: None = Depends(require_roles(\"admin\"))\n    ):\n        return {\"message\": \"Admin only\"}\n    ```\n    \"\"\"\n    async def check_roles(\n        current_user: TokenPayload = Depends(get_current_user)\n    ) -&gt; None:\n        # Ensure the user is authenticated\n        if not current_user:\n            raise HTTPException(\n                status_code=status.HTTP_401_UNAUTHORIZED,\n                detail=\"Not authenticated\"\n            )\n\n        # Check that at least one of the required roles is present in token\n        if roles:\n            user_roles = set(getattr(current_user, \"roles\", []) or [])\n            required = set(roles)\n            if user_roles.isdisjoint(required):\n                raise HTTPException(\n                    status_code=status.HTTP_403_FORBIDDEN,\n                    detail=\"Insufficient permissions\"\n                )\n\n    return check_roles\n</code></pre>"},{"location":"api/repositories/base/","title":"\u0411\u0430\u0437\u043e\u0432\u044b\u0439 \u0440\u0435\u043f\u043e\u0437\u0438\u0442\u043e\u0440\u0438\u0439","text":"<p>\u0410\u0431\u0441\u0442\u0440\u0430\u043a\u0442\u043d\u044b\u0439 \u0431\u0430\u0437\u043e\u0432\u044b\u0439 \u043a\u043b\u0430\u0441\u0441 \u0434\u043b\u044f \u0440\u0435\u043f\u043e\u0437\u0438\u0442\u043e\u0440\u0438\u0435\u0432.</p>"},{"location":"api/repositories/base/#api-reference","title":"API Reference","text":"<p>Base repository with common CRUD operations.</p>"},{"location":"api/repositories/base/#app.repositories.base-classes","title":"Classes","text":""},{"location":"api/repositories/base/#app.repositories.base.base_repository","title":"base_repository","text":"<pre><code>base_repository(table_name: str, schema: str = 'personal_account', default_order_by: str = 'created_at', orderable_columns: Iterable[str] | None = None)\n</code></pre> <p>Base repository class with common database operations.</p> Source code in <code>app/repositories/base.py</code> <pre><code>def __init__(\n    self,\n    table_name: str,\n    schema: str = \"personal_account\",\n    default_order_by: str = \"created_at\",\n    orderable_columns: Iterable[str] | None = None,\n):\n    self.table_name = table_name\n    self.schema = schema\n    self.full_table_name = f\"{schema}.{table_name}\"\n    self.default_order_by = default_order_by\n    base_columns = orderable_columns or self.allowed_order_fields\n    self.orderable_columns = {column.lower() for column in base_columns}\n    if self.default_order_by.lower() not in self.orderable_columns:\n        self.orderable_columns.add(self.default_order_by.lower())\n    self._table_identifier = self.full_table_name\n</code></pre>"},{"location":"api/repositories/base/#app.repositories.base.base_repository-functions","title":"Functions","text":""},{"location":"api/repositories/base/#app.repositories.base.base_repository.get_by_id","title":"get_by_id  <code>async</code>","text":"<pre><code>get_by_id(entity_id: UUID) -&gt; dict[str, Any] | None\n</code></pre> <p>Get entity by ID.</p> Source code in <code>app/repositories/base.py</code> <pre><code>@traced()\nasync def get_by_id(self, entity_id: UUID) -&gt; dict[str, Any] | None:\n    \"\"\"Get entity by ID.\"\"\"\n    query = q.BASE_SELECT_BY_ID.format(table=self._table_identifier)\n    return await fetch_one(query, {\"id\": entity_id})\n</code></pre>"},{"location":"api/repositories/base/#app.repositories.base.base_repository.get_all","title":"get_all  <code>async</code>","text":"<pre><code>get_all(limit: int = 100, offset: int = 0, order_by: str | None = None, order_dir: str = 'DESC') -&gt; list[dict[str, Any]]\n</code></pre> <p>Get all entities with pagination.</p> Source code in <code>app/repositories/base.py</code> <pre><code>@traced()\nasync def get_all(\n    self, \n    limit: int = 100, \n    offset: int = 0,\n    order_by: str | None = None,\n    order_dir: str = \"DESC\"\n) -&gt; list[dict[str, Any]]:\n    \"\"\"Get all entities with pagination.\"\"\"\n    order_column = self._resolve_order_column(order_by)\n    order_direction = self._resolve_order_direction(order_dir)\n    query = q.BASE_SELECT_ALL.format(\n        table=self._table_identifier,\n        order_clause=f\"{order_column} {order_direction}\",\n    )\n    return await fetch_all(query, {\"limit\": limit, \"offset\": offset})\n</code></pre>"},{"location":"api/repositories/base/#app.repositories.base.base_repository.count","title":"count  <code>async</code>","text":"<pre><code>count(where_clause: str = '', params: Mapping[str, Any] | None = None) -&gt; int\n</code></pre> <p>Count entities.</p> Source code in <code>app/repositories/base.py</code> <pre><code>@traced()\nasync def count(\n    self, where_clause: str = \"\", params: Mapping[str, Any] | None = None\n) -&gt; int:\n    \"\"\"Count entities.\"\"\"\n    clause = f\"WHERE {where_clause}\" if where_clause else \"\"\n    query = q.BASE_COUNT.format(table=self._table_identifier, where_clause=clause)\n    result = await fetch_one(query, params or {})\n    return result[\"count\"] if result else 0\n</code></pre>"},{"location":"api/repositories/base/#app.repositories.base.base_repository.delete","title":"delete  <code>async</code>","text":"<pre><code>delete(entity_id: UUID) -&gt; bool\n</code></pre> <p>Delete entity by ID.</p> Source code in <code>app/repositories/base.py</code> <pre><code>@traced()\nasync def delete(self, entity_id: UUID) -&gt; bool:\n    \"\"\"Delete entity by ID.\"\"\"\n    query = q.BASE_DELETE.format(table=self._table_identifier)\n    affected = await execute(query, {\"id\": entity_id})\n    return affected &gt; 0\n</code></pre>"},{"location":"api/repositories/base/#app.repositories.base.base_repository.exists","title":"exists  <code>async</code>","text":"<pre><code>exists(entity_id: UUID) -&gt; bool\n</code></pre> <p>Check if entity exists.</p> Source code in <code>app/repositories/base.py</code> <pre><code>@traced()\nasync def exists(self, entity_id: UUID) -&gt; bool:\n    \"\"\"Check if entity exists.\"\"\"\n    query = q.BASE_EXISTS.format(table=self._table_identifier)\n    result = await fetch_one(query, {\"id\": entity_id})\n    return result is not None\n</code></pre>"},{"location":"api/repositories/base/#app.repositories.base-functions","title":"Functions","text":""},{"location":"api/repositories/certificate/","title":"\u0420\u0435\u043f\u043e\u0437\u0438\u0442\u043e\u0440\u0438\u0439 \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0432","text":"<p>\u0421\u043b\u043e\u0439 \u0440\u0430\u0431\u043e\u0442\u044b \u0441 \u0411\u0414 \u0434\u043b\u044f \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0432.</p>"},{"location":"api/repositories/certificate/#api-reference","title":"API Reference","text":"<p>Certificate repository.</p>"},{"location":"api/repositories/certificate/#app.repositories.certificate-attributes","title":"Attributes","text":""},{"location":"api/repositories/certificate/#app.repositories.certificate.certificate_repository","title":"certificate_repository  <code>module-attribute</code>","text":"<pre><code>certificate_repository = certificate_repository()\n</code></pre> <p>Repository for certificate operations.</p>"},{"location":"api/repositories/certificate/#app.repositories.certificate-classes","title":"Classes","text":""},{"location":"api/repositories/certificate/#app.repositories.certificate-functions","title":"Functions","text":""},{"location":"api/repositories/student/","title":"\u0420\u0435\u043f\u043e\u0437\u0438\u0442\u043e\u0440\u0438\u0439 \u0441\u0442\u0443\u0434\u0435\u043d\u0442\u043e\u0432","text":"<p>\u0421\u043b\u043e\u0439 \u0440\u0430\u0431\u043e\u0442\u044b \u0441 \u0411\u0414 \u0434\u043b\u044f \u0441\u0442\u0443\u0434\u0435\u043d\u0442\u043e\u0432.</p>"},{"location":"api/repositories/student/#api-reference","title":"API Reference","text":"<p>Student repository.</p>"},{"location":"api/repositories/student/#app.repositories.student-attributes","title":"Attributes","text":""},{"location":"api/repositories/student/#app.repositories.student.student_repository","title":"student_repository  <code>module-attribute</code>","text":"<pre><code>student_repository = student_repository()\n</code></pre> <p>Repository for student operations.</p>"},{"location":"api/repositories/student/#app.repositories.student-classes","title":"Classes","text":""},{"location":"api/repositories/student/#app.repositories.student-functions","title":"Functions","text":""},{"location":"api/repositories/visit/","title":"\u0420\u0435\u043f\u043e\u0437\u0438\u0442\u043e\u0440\u0438\u0439 \u0432\u0438\u0437\u0438\u0442\u043e\u0432","text":"<p>\u0421\u043b\u043e\u0439 \u0440\u0430\u0431\u043e\u0442\u044b \u0441 \u0411\u0414 \u0434\u043b\u044f \u0443\u0447\u0451\u0442\u0430 \u043f\u043e\u0441\u0435\u0449\u0435\u043d\u0438\u0439.</p>"},{"location":"api/repositories/visit/#api-reference","title":"API Reference","text":"<p>Visit repository.</p>"},{"location":"api/repositories/visit/#app.repositories.visit-attributes","title":"Attributes","text":""},{"location":"api/repositories/visit/#app.repositories.visit.visit_repository","title":"visit_repository  <code>module-attribute</code>","text":"<pre><code>visit_repository = visit_repository()\n</code></pre> <p>Repository for visit operations.</p>"},{"location":"api/repositories/visit/#app.repositories.visit-classes","title":"Classes","text":""},{"location":"api/repositories/visit/#app.repositories.visit-functions","title":"Functions","text":""},{"location":"api/routers/auth/","title":"Auth Router","text":"<p>API endpoints \u0434\u043b\u044f \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u0438.</p>"},{"location":"api/routers/auth/#endpoints","title":"Endpoints","text":"Method Path Description POST <code>/api/v1/auth/token</code> \u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c JWT \u0442\u043e\u043a\u0435\u043d POST <code>/api/v1/auth/logout</code> \u0412\u044b\u0439\u0442\u0438 \u0438\u0437 \u0441\u0438\u0441\u0442\u0435\u043c\u044b GET <code>/api/v1/auth/me</code> \u0418\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f \u043e \u0442\u0435\u043a\u0443\u0449\u0435\u043c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435"},{"location":"api/routers/auth/#api-reference","title":"API Reference","text":"<p>Authentication API endpoints.</p>"},{"location":"api/routers/auth/#app.routers.auth-classes","title":"Classes","text":""},{"location":"api/routers/auth/#app.routers.auth.Refresh_Token_Request","title":"Refresh_Token_Request","text":"<p>               Bases: <code>BaseModel</code></p> <p>Refresh token request body.</p>"},{"location":"api/routers/auth/#app.routers.auth.Logout_Request","title":"Logout_Request","text":"<p>               Bases: <code>BaseModel</code></p> <p>Logout request body.</p>"},{"location":"api/routers/auth/#app.routers.auth.Password_Token_Request","title":"Password_Token_Request","text":"<p>               Bases: <code>BaseModel</code></p> <p>Password token request body.</p>"},{"location":"api/routers/auth/#app.routers.auth-functions","title":"Functions","text":""},{"location":"api/routers/auth/#app.routers.auth.get_token","title":"get_token  <code>async</code>","text":"<pre><code>get_token(body: Password_Token_Request)\n</code></pre> <p>Get access token using username and password.</p> Source code in <code>app/routers/auth.py</code> <pre><code>@router.post(\n    \"/token\",\n    response_model=api_response[token_response],\n    summary=\"Get access token\",\n    description=\"Get access token by username and password (OAuth2 password flow).\"\n)\n@traced(\"router.auth.token\")\nasync def get_token(body: Password_Token_Request):\n    \"\"\"Get access token using username and password.\"\"\"\n    token = await auth_service.get_token_by_password(body.username, body.password)\n    token_data = token_response(\n        access_token=token.get(\"access_token\", \"\"),\n        refresh_token=token.get(\"refresh_token\"),\n        token_type=token.get(\"token_type\", \"Bearer\"),\n        expires_in=token.get(\"expires_in\", 0),\n        refresh_expires_in=token.get(\"refresh_expires_in\"),\n        scope=token.get(\"scope\")\n    )\n    return api_response(data=token_data, message=\"Token obtained successfully\")\n</code></pre>"},{"location":"api/routers/auth/#app.routers.auth.login","title":"login  <code>async</code>","text":"<pre><code>login()\n</code></pre> <p>Initiate login flow.</p> Source code in <code>app/routers/auth.py</code> <pre><code>@router.get(\n    \"/login\",\n    summary=\"Redirect to Keycloak login\",\n    description=\"Redirects the user to the Keycloak login page for the Student realm.\"\n)\n@traced(\"router.auth.login\", record_result=True)\nasync def login():\n    \"\"\"Initiate login flow.\"\"\"\n    login_url = auth_service.get_login_url()\n    # Log the redirect URL to help diagnose 'client not found' errors\n    try:\n        logger.debug(\"Redirecting to Keycloak login URL: %s\", login_url)\n    except Exception:\n        pass\n    return RedirectResponse(url=login_url)\n</code></pre>"},{"location":"api/routers/auth/#app.routers.auth.callback","title":"callback  <code>async</code>","text":"<pre><code>callback(code: str)\n</code></pre> <p>Handle login callback and set secure cookie with access token.</p> Source code in <code>app/routers/auth.py</code> <pre><code>@router.get(\n    \"/callback\",\n    summary=\"Handle Keycloak callback\",\n    description=\"Exchanges the authorization code for an access token and sets secure cookies.\"\n)\n@traced(\"router.auth.callback\")\nasync def callback(code: str):\n    \"\"\"Handle login callback and set secure cookie with access token.\"\"\"\n    logger.info(f\"Callback received with code: {code[:20]}...\" if len(code) &gt; 20 else f\"Callback received with code: {code}\")\n    try:\n        token = await auth_service.exchange_code_for_token(code)\n\n        # Create response with JSON data\n        token_data = token_response(\n            access_token=token.get(\"access_token\", \"\"),\n            refresh_token=token.get(\"refresh_token\"),\n            token_type=token.get(\"token_type\", \"Bearer\"),\n            expires_in=token.get(\"expires_in\", 0),\n            refresh_expires_in=token.get(\"refresh_expires_in\"),\n            scope=token.get(\"scope\")\n        )\n\n        response_data = api_response(data=token_data, message=\"Login successful\")\n        response = JSONResponse(content=response_data.model_dump())\n\n        # Set secure HTTP-only cookie for access token\n        response.set_cookie(\n            key=\"access_token\",\n            value=token.get(\"access_token\", \"\"),\n            max_age=token.get(\"expires_in\", 3600),\n            httponly=True,\n            secure=True,  # Requires HTTPS in production\n            samesite=\"Lax\",\n            path=\"/\"\n        )\n\n        # Set refresh token cookie if provided\n        if token.get(\"refresh_token\"):\n            response.set_cookie(\n                key=\"refresh_token\",\n                value=token.get(\"refresh_token\", \"\"),\n                max_age=token.get(\"refresh_expires_in\", 86400),\n                httponly=True,\n                secure=True,  # Requires HTTPS in production\n                samesite=\"Lax\",\n                path=\"/\"\n            )\n\n        logger.info(\"Callback successful, tokens set in secure cookies\")\n        return response\n\n    except HTTPException as e:\n        logger.error(f\"Callback failed: {e.detail}\")\n        raise\n    except Exception as e:\n        logger.error(f\"Unexpected callback error: {str(e)}\")\n        raise HTTPException(\n            status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n            detail=f\"Callback failed: {str(e)}\"\n        )\n</code></pre>"},{"location":"api/routers/auth/#app.routers.auth.refresh","title":"refresh  <code>async</code>","text":"<pre><code>refresh(body: Refresh_Token_Request)\n</code></pre> <p>Refresh access token.</p> Source code in <code>app/routers/auth.py</code> <pre><code>@router.post(\n    \"/refresh\",\n    response_model=api_response[token_response],\n    summary=\"Refresh access token\",\n    description=\"Exchanges a refresh token for a new access token.\"\n)\n@traced(\"router.auth.refresh\")\nasync def refresh(body: Refresh_Token_Request):\n    \"\"\"Refresh access token.\"\"\"\n    token = await auth_service.refresh_token(body.refresh_token)\n    token_data = token_response(\n        access_token=token.get(\"access_token\", \"\"),\n        refresh_token=token.get(\"refresh_token\"),\n        token_type=token.get(\"token_type\", \"Bearer\"),\n        expires_in=token.get(\"expires_in\", 0),\n        refresh_expires_in=token.get(\"refresh_expires_in\"),\n        scope=token.get(\"scope\")\n    )\n    return api_response(data=token_data, message=\"Token refreshed successfully\")\n</code></pre>"},{"location":"api/routers/auth/#app.routers.auth.logout","title":"logout  <code>async</code>","text":"<pre><code>logout(body: Optional[Logout_Request] = None)\n</code></pre> <p>Logout user.</p> <p>Works with both: 1. Traditional: body with refresh_token for logout from other clients 2. Cookie-based: empty body, relies on server-side session invalidation</p> Source code in <code>app/routers/auth.py</code> <pre><code>@router.post(\n    \"/logout\",\n    response_model=api_response[message_response],\n    summary=\"Logout user\",\n    description=\"Logs out the user by clearing server-side session and cookies.\"\n)\n@traced(\"router.auth.logout\")\nasync def logout(body: Optional[Logout_Request] = None):\n    \"\"\"Logout user.\n\n    Works with both:\n    1. Traditional: body with refresh_token for logout from other clients\n    2. Cookie-based: empty body, relies on server-side session invalidation\n    \"\"\"\n    if body and body.refresh_token:\n        await auth_service.logout(body.refresh_token)\n\n    # Create response that clears cookies\n    response = JSONResponse(\n        content=api_response(data=message_response(message=\"Logged out successfully\")).model_dump()\n    )\n\n    # Clear access_token cookie\n    response.delete_cookie(\n        key=\"access_token\",\n        path=\"/\"\n    )\n\n    # Clear refresh_token cookie\n    response.delete_cookie(\n        key=\"refresh_token\",\n        path=\"/\"\n    )\n\n    return response\n</code></pre>"},{"location":"api/routers/auth/#app.routers.auth.get_me","title":"get_me  <code>async</code>","text":"<pre><code>get_me(user: TokenPayload = Depends(get_current_user))\n</code></pre> <p>Get current user profile.</p> Source code in <code>app/routers/auth.py</code> <pre><code>@router.get(\n    \"/me\",\n    response_model=api_response[user_info_response],\n    summary=\"Get current user info\",\n    description=\"Returns information about the currently authenticated user.\"\n)\n@traced(\"router.auth.me\")\nasync def get_me(user: TokenPayload = Depends(get_current_user)):\n    \"\"\"Get current user profile.\"\"\"\n    user_data = user_info_response(\n        sub=user.sub,\n        email=user.email,\n        preferred_username=user.preferred_username,\n        name=user.name,\n        given_name=user.given_name,\n        family_name=user.family_name,\n        email_verified=user.email_verified\n    )\n    return api_response(data=user_data)\n</code></pre>"},{"location":"api/routers/auth/#app.routers.auth.register_redirect","title":"register_redirect  <code>async</code>","text":"<pre><code>register_redirect()\n</code></pre> <p>Redirect to Keycloak registration page.</p> Source code in <code>app/routers/auth.py</code> <pre><code>@router.get(\n    \"/register\",\n    summary=\"Redirect to Keycloak registration\",\n    description=\"Redirects the user to the Keycloak registration page.\"\n)\n@traced(\"router.auth.register_redirect\")\nasync def register_redirect():\n    \"\"\"Redirect to Keycloak registration page.\"\"\"\n    register_url = auth_service.get_register_url()\n    return RedirectResponse(url=register_url)\n</code></pre>"},{"location":"api/routers/auth/#app.routers.auth.register","title":"register  <code>async</code>","text":"<pre><code>register(body: register_request)\n</code></pre> <p>Register a new user via API.</p> Source code in <code>app/routers/auth.py</code> <pre><code>@router.post(\n    \"/register\",\n    response_model=api_response[register_response],\n    status_code=status.HTTP_201_CREATED,\n    summary=\"Register new user\",\n    description=\"Creates a new user account in Keycloak. Available for both students and teachers.\"\n)\n@traced(\"router.auth.register\")\nasync def register(body: register_request):\n    \"\"\"Register a new user via API.\"\"\"\n    result = await auth_service.register_user(\n        username=body.username,\n        email=body.email,\n        password=body.password,\n        first_name=body.first_name,\n        last_name=body.last_name\n    )\n\n    response_data = register_response(\n        user_id=result[\"user_id\"],\n        username=result[\"username\"],\n        email=result[\"email\"]\n    )\n    return api_response(data=response_data, message=\"User registered successfully\")\n</code></pre>"},{"location":"api/routers/certificates/","title":"Certificates Router","text":"<p>API endpoints \u0434\u043b\u044f \u0443\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u044f \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u0430\u043c\u0438.</p>"},{"location":"api/routers/certificates/#endpoints","title":"Endpoints","text":"Method Path Description GET <code>/api/v1/certificates</code> \u0421\u043f\u0438\u0441\u043e\u043a \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0432 GET <code>/api/v1/certificates/{id}</code> \u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442 \u043f\u043e ID POST <code>/api/v1/certificates</code> \u0421\u043e\u0437\u0434\u0430\u0442\u044c \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442"},{"location":"api/routers/certificates/#api-reference","title":"API Reference","text":"<p>Certificate API endpoints.</p>"},{"location":"api/routers/certificates/#app.routers.certificates-attributes","title":"Attributes","text":""},{"location":"api/routers/certificates/#app.routers.certificates-classes","title":"Classes","text":""},{"location":"api/routers/certificates/#app.routers.certificates-functions","title":"Functions","text":""},{"location":"api/routers/certificates/#app.routers.certificates.get_certificates","title":"get_certificates  <code>async</code>","text":"<pre><code>get_certificates(student_id: UUID | None = Query(default=None, description='\u0424\u0438\u043b\u044c\u0442\u0440 \u043f\u043e \u0441\u0442\u0443\u0434\u0435\u043d\u0442\u0443'), course_id: UUID | None = Query(default=None, description='\u0424\u0438\u043b\u044c\u0442\u0440 \u043f\u043e \u043a\u0443\u0440\u0441\u0443'), current_user: TokenPayload = Depends(get_current_user))\n</code></pre> <p>Get list of certificates with optional filters.</p> Source code in <code>app/routers/certificates.py</code> <pre><code>@router.get(\n    \"\",\n    response_model=list[certificate_response],\n    summary=\"\u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0441\u043f\u0438\u0441\u043e\u043a \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0432\",\n    description=\"\u0412\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u0441\u043f\u0438\u0441\u043e\u043a \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0432 \u0441 \u043e\u043f\u0446\u0438\u043e\u043d\u0430\u043b\u044c\u043d\u043e\u0439 \u0444\u0438\u043b\u044c\u0442\u0440\u0430\u0446\u0438\u0435\u0439 \u043f\u043e \u0441\u0442\u0443\u0434\u0435\u043d\u0442\u0443 \u0438 \u043a\u0443\u0440\u0441\u0443\"\n)\n@traced(\"router.certificates.get_certificates\")\nasync def get_certificates(\n    student_id: UUID | None = Query(default=None, description=\"\u0424\u0438\u043b\u044c\u0442\u0440 \u043f\u043e \u0441\u0442\u0443\u0434\u0435\u043d\u0442\u0443\"),\n    course_id: UUID | None = Query(default=None, description=\"\u0424\u0438\u043b\u044c\u0442\u0440 \u043f\u043e \u043a\u0443\u0440\u0441\u0443\"),\n    current_user: TokenPayload = Depends(get_current_user)\n):\n    \"\"\"Get list of certificates with optional filters.\"\"\"\n    return await certificate_service.get_certificates(student_id, course_id)\n</code></pre>"},{"location":"api/routers/certificates/#app.routers.certificates.get_certificate","title":"get_certificate  <code>async</code>","text":"<pre><code>get_certificate(certificate_id: UUID, current_user: TokenPayload = Depends(get_current_user))\n</code></pre> <p>Get certificate by ID.</p> Source code in <code>app/routers/certificates.py</code> <pre><code>@router.get(\n    \"/{certificate_id}\",\n    response_model=certificate_response,\n    summary=\"\u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442 \u043f\u043e ID\",\n    description=\"\u0412\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0435 \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u0430 \u043f\u043e \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u043e\u043c\u0443 ID\"\n)\n@traced(\"router.certificates.get_certificate\")\nasync def get_certificate(\n    certificate_id: UUID,\n    current_user: TokenPayload = Depends(get_current_user)\n):\n    \"\"\"Get certificate by ID.\"\"\"\n    return await certificate_service.get_certificate(certificate_id)\n</code></pre>"},{"location":"api/routers/certificates/#app.routers.certificates.create_certificate","title":"create_certificate  <code>async</code>","text":"<pre><code>create_certificate(certificate: certificate_create, current_user: TokenPayload = Depends(require_roles('admin')))\n</code></pre> <p>Create a new certificate.</p> Source code in <code>app/routers/certificates.py</code> <pre><code>@router.post(\n    \"\",\n    response_model=certificate_response,\n    status_code=status.HTTP_201_CREATED,\n    summary=\"\u0421\u043e\u0437\u0434\u0430\u0442\u044c \u043d\u043e\u0432\u044b\u0439 \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\",\n    description=\"\u0421\u043e\u0437\u0434\u0430\u0435\u0442 \u043d\u043e\u0432\u044b\u0439 \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442 \u0434\u043b\u044f \u0441\u0442\u0443\u0434\u0435\u043d\u0442\u0430\"\n)\n@traced(\"router.certificates.create_certificate\")\nasync def create_certificate(\n    certificate: certificate_create,\n    current_user: TokenPayload = Depends(require_roles(\"admin\"))\n):\n    \"\"\"Create a new certificate.\"\"\"\n    return await certificate_service.create_certificate(certificate)\n</code></pre>"},{"location":"api/routers/certificates/#app.routers.certificates.delete_certificate","title":"delete_certificate  <code>async</code>","text":"<pre><code>delete_certificate(certificate_id: UUID)\n</code></pre> <p>Delete certificate by ID.</p> Source code in <code>app/routers/certificates.py</code> <pre><code>@router.delete(\n    \"/{certificate_id}\",\n    status_code=status.HTTP_204_NO_CONTENT,\n    summary=\"\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\",\n    description=\"\u0423\u0434\u0430\u043b\u044f\u0435\u0442 \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442 \u0438\u0437 \u0441\u0438\u0441\u0442\u0435\u043c\u044b\"\n)\n@traced(\"router.certificates.delete_certificate\")\nasync def delete_certificate(certificate_id: UUID):\n    \"\"\"Delete certificate by ID.\"\"\"\n    await certificate_service.delete_certificate(certificate_id)\n    return None\n</code></pre>"},{"location":"api/routers/health/","title":"Health Router","text":"<p>Health check endpoints \u0434\u043b\u044f \u043c\u043e\u043d\u0438\u0442\u043e\u0440\u0438\u043d\u0433\u0430.</p>"},{"location":"api/routers/health/#endpoints","title":"Endpoints","text":"Method Path Description GET <code>/health</code> \u0411\u0430\u0437\u043e\u0432\u044b\u0439 health check GET <code>/health/ready</code> Readiness probe GET <code>/health/live</code> Liveness probe"},{"location":"api/routers/health/#api-reference","title":"API Reference","text":"<p>Health check endpoints.</p>"},{"location":"api/routers/health/#app.routers.health-functions","title":"Functions","text":""},{"location":"api/routers/health/#app.routers.health.health_check","title":"health_check  <code>async</code>","text":"<pre><code>health_check()\n</code></pre> <p>Basic health check endpoint.</p> Source code in <code>app/routers/health.py</code> <pre><code>@router.get(\n    \"/health\",\n    summary=\"Health check\",\n    description=\"\u041f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u0440\u0430\u0431\u043e\u0442\u043e\u0441\u043f\u043e\u0441\u043e\u0431\u043d\u043e\u0441\u0442\u0438 \u0441\u0435\u0440\u0432\u0438\u0441\u0430\"\n)\nasync def health_check():\n    \"\"\"Basic health check endpoint.\"\"\"\n    return {\"status\": \"healthy\"}\n</code></pre>"},{"location":"api/routers/health/#app.routers.health.db_health_check","title":"db_health_check  <code>async</code>","text":"<pre><code>db_health_check()\n</code></pre> <p>Database connectivity health check.</p> Source code in <code>app/routers/health.py</code> <pre><code>@router.get(\n    \"/health/db\",\n    summary=\"Database health check\",\n    description=\"\u041f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f \u043a \u0431\u0430\u0437\u0435 \u0434\u0430\u043d\u043d\u044b\u0445\"\n)\nasync def db_health_check():\n    \"\"\"Database connectivity health check.\"\"\"\n    try:\n        result = await fetch_one(\"SELECT 1 as ok\")\n        if result and result.get(\"ok\") == 1:\n            return {\"status\": \"healthy\", \"database\": \"connected\"}\n        return {\"status\": \"unhealthy\", \"database\": \"query failed\"}\n    except Exception as e:\n        return {\"status\": \"unhealthy\", \"database\": \"disconnected\", \"error\": str(e)}\n</code></pre>"},{"location":"api/routers/students/","title":"Students Router","text":"<p>API endpoints \u0434\u043b\u044f \u0443\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u044f \u0441\u0442\u0443\u0434\u0435\u043d\u0442\u0430\u043c\u0438.</p>"},{"location":"api/routers/students/#endpoints","title":"Endpoints","text":"Method Path Description GET <code>/api/v1/students</code> \u0421\u043f\u0438\u0441\u043e\u043a \u0441\u0442\u0443\u0434\u0435\u043d\u0442\u043e\u0432 (\u043f\u0430\u0433\u0438\u043d\u0430\u0446\u0438\u044f) GET <code>/api/v1/students/{id}</code> \u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0441\u0442\u0443\u0434\u0435\u043d\u0442\u0430 \u043f\u043e ID POST <code>/api/v1/students</code> \u0421\u043e\u0437\u0434\u0430\u0442\u044c \u0441\u0442\u0443\u0434\u0435\u043d\u0442\u0430 PUT <code>/api/v1/students/{id}</code> \u041e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u0441\u0442\u0443\u0434\u0435\u043d\u0442\u0430 DELETE <code>/api/v1/students/{id}</code> \u0423\u0434\u0430\u043b\u0438\u0442\u044c \u0441\u0442\u0443\u0434\u0435\u043d\u0442\u0430"},{"location":"api/routers/students/#api-reference","title":"API Reference","text":"<p>Student API endpoints.</p>"},{"location":"api/routers/students/#app.routers.students-attributes","title":"Attributes","text":""},{"location":"api/routers/students/#app.routers.students-classes","title":"Classes","text":""},{"location":"api/routers/students/#app.routers.students-functions","title":"Functions","text":""},{"location":"api/routers/students/#app.routers.students.get_students","title":"get_students  <code>async</code>","text":"<pre><code>get_students(page: int = Query(default=1, ge=1, description='\u041d\u043e\u043c\u0435\u0440 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u044b'), limit: int = Query(default=20, ge=1, le=100, description='\u041a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u043e\u0432 \u043d\u0430 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0435'), current_user: TokenPayload = Depends(get_current_user))\n</code></pre> <p>Get paginated list of students.</p> Source code in <code>app/routers/students.py</code> <pre><code>@router.get(\n    \"\",\n    response_model=paginated_response[student_response],\n    summary=\"\u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0441\u043f\u0438\u0441\u043e\u043a \u0441\u0442\u0443\u0434\u0435\u043d\u0442\u043e\u0432\",\n    description=\"\u0412\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u043f\u0430\u0433\u0438\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u0441\u043f\u0438\u0441\u043e\u043a \u0432\u0441\u0435\u0445 \u0441\u0442\u0443\u0434\u0435\u043d\u0442\u043e\u0432\"\n)\n@traced(\"router.students.get_students\")\nasync def get_students(\n    page: int = Query(default=1, ge=1, description=\"\u041d\u043e\u043c\u0435\u0440 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u044b\"),\n    limit: int = Query(default=20, ge=1, le=100, description=\"\u041a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u043e\u0432 \u043d\u0430 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0435\"),\n    current_user: TokenPayload = Depends(get_current_user)\n):\n    \"\"\"Get paginated list of students.\"\"\"\n    return await student_service.get_students(page, limit)\n</code></pre>"},{"location":"api/routers/students/#app.routers.students.get_student","title":"get_student  <code>async</code>","text":"<pre><code>get_student(student_id: UUID, current_user: TokenPayload = Depends(get_current_user))\n</code></pre> <p>Get student by ID.</p> Source code in <code>app/routers/students.py</code> <pre><code>@router.get(\n    \"/{student_id}\",\n    response_model=student_response,\n    summary=\"\u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0441\u0442\u0443\u0434\u0435\u043d\u0442\u0430 \u043f\u043e ID\",\n    description=\"\u0412\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0435 \u0441\u0442\u0443\u0434\u0435\u043d\u0442\u0430 \u043f\u043e \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u043e\u043c\u0443 ID\"\n)\n@traced(\"router.students.get_student\")\nasync def get_student(\n    student_id: UUID,\n    current_user: TokenPayload = Depends(get_current_user)\n):\n    \"\"\"Get student by ID.\"\"\"\n    return await student_service.get_student(student_id)\n</code></pre>"},{"location":"api/routers/students/#app.routers.students.create_student","title":"create_student  <code>async</code>","text":"<pre><code>create_student(student: student_create, current_user: TokenPayload = Depends(require_roles('admin')))\n</code></pre> <p>Create a new student.</p> Source code in <code>app/routers/students.py</code> <pre><code>@router.post(\n    \"\",\n    response_model=student_response,\n    status_code=status.HTTP_201_CREATED,\n    summary=\"\u0421\u043e\u0437\u0434\u0430\u0442\u044c \u043d\u043e\u0432\u043e\u0433\u043e \u0441\u0442\u0443\u0434\u0435\u043d\u0442\u0430\",\n    description=\"\u0421\u043e\u0437\u0434\u0430\u0435\u0442 \u043d\u043e\u0432\u043e\u0433\u043e \u0441\u0442\u0443\u0434\u0435\u043d\u0442\u0430 \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0435\"\n)\n@traced(\"router.students.create_student\")\nasync def create_student(\n    student: student_create,\n    current_user: TokenPayload = Depends(require_roles(\"admin\"))\n):\n    \"\"\"Create a new student.\"\"\"\n    return await student_service.create_student(student)\n</code></pre>"},{"location":"api/routers/students/#app.routers.students.update_student","title":"update_student  <code>async</code>","text":"<pre><code>update_student(student_id: UUID, student: student_update)\n</code></pre> <p>Update student by ID.</p> Source code in <code>app/routers/students.py</code> <pre><code>@router.put(\n    \"/{student_id}\",\n    response_model=student_response,\n    summary=\"\u041e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 \u0441\u0442\u0443\u0434\u0435\u043d\u0442\u0430\",\n    description=\"\u041e\u0431\u043d\u043e\u0432\u043b\u044f\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u044e\u0449\u0435\u0433\u043e \u0441\u0442\u0443\u0434\u0435\u043d\u0442\u0430\"\n)\n@traced(\"router.students.update_student\")\nasync def update_student(student_id: UUID, student: student_update):\n    \"\"\"Update student by ID.\"\"\"\n    return await student_service.update_student(student_id, student)\n</code></pre>"},{"location":"api/routers/students/#app.routers.students.delete_student","title":"delete_student  <code>async</code>","text":"<pre><code>delete_student(student_id: UUID)\n</code></pre> <p>Delete student by ID.</p> Source code in <code>app/routers/students.py</code> <pre><code>@router.delete(\n    \"/{student_id}\",\n    status_code=status.HTTP_204_NO_CONTENT,\n    summary=\"\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u0441\u0442\u0443\u0434\u0435\u043d\u0442\u0430\",\n    description=\"\u0423\u0434\u0430\u043b\u044f\u0435\u0442 \u0441\u0442\u0443\u0434\u0435\u043d\u0442\u0430 \u0438\u0437 \u0441\u0438\u0441\u0442\u0435\u043c\u044b\"\n)\n@traced(\"router.students.delete_student\")\nasync def delete_student(student_id: UUID):\n    \"\"\"Delete student by ID.\"\"\"\n    await student_service.delete_student(student_id)\n    return None\n</code></pre>"},{"location":"api/routers/visits/","title":"Visits Router","text":"<p>API endpoints \u0434\u043b\u044f \u043e\u0442\u0441\u043b\u0435\u0436\u0438\u0432\u0430\u043d\u0438\u044f \u043f\u043e\u0441\u0435\u0449\u0430\u0435\u043c\u043e\u0441\u0442\u0438.</p>"},{"location":"api/routers/visits/#endpoints","title":"Endpoints","text":"Method Path Description GET <code>/api/v1/visits</code> \u0421\u043f\u0438\u0441\u043e\u043a \u043f\u043e\u0441\u0435\u0449\u0435\u043d\u0438\u0439 POST <code>/api/v1/visits</code> \u0417\u0430\u043f\u0438\u0441\u0430\u0442\u044c \u043f\u043e\u0441\u0435\u0449\u0435\u043d\u0438\u0435"},{"location":"api/routers/visits/#api-reference","title":"API Reference","text":"<p>Visit API endpoints.</p>"},{"location":"api/routers/visits/#app.routers.visits-attributes","title":"Attributes","text":""},{"location":"api/routers/visits/#app.routers.visits-classes","title":"Classes","text":""},{"location":"api/routers/visits/#app.routers.visits-functions","title":"Functions","text":""},{"location":"api/routers/visits/#app.routers.visits.get_visits","title":"get_visits  <code>async</code>","text":"<pre><code>get_visits(student_id: UUID | None = Query(default=None, description='\u0424\u0438\u043b\u044c\u0442\u0440 \u043f\u043e \u0441\u0442\u0443\u0434\u0435\u043d\u0442\u0443'), lesson_id: UUID | None = Query(default=None, description='\u0424\u0438\u043b\u044c\u0442\u0440 \u043f\u043e \u0443\u0440\u043e\u043a\u0443'), current_user: TokenPayload = Depends(get_current_user))\n</code></pre> <p>Get list of visits with optional filters.</p> Source code in <code>app/routers/visits.py</code> <pre><code>@router.get(\n    \"\",\n    response_model=list[visit_response],\n    summary=\"\u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0441\u043f\u0438\u0441\u043e\u043a \u043f\u043e\u0441\u0435\u0449\u0435\u043d\u0438\u0439 \u0443\u0440\u043e\u043a\u043e\u0432\",\n    description=\"\u0412\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u0441\u043f\u0438\u0441\u043e\u043a \u043f\u043e\u0441\u0435\u0449\u0435\u043d\u0438\u0439 \u0441 \u043e\u043f\u0446\u0438\u043e\u043d\u0430\u043b\u044c\u043d\u043e\u0439 \u0444\u0438\u043b\u044c\u0442\u0440\u0430\u0446\u0438\u0435\u0439 \u043f\u043e \u0441\u0442\u0443\u0434\u0435\u043d\u0442\u0443 \u0438 \u0443\u0440\u043e\u043a\u0443\"\n)\n@traced(\"router.visits.get_visits\", record_args=True, record_result=True)\nasync def get_visits(\n    student_id: UUID | None = Query(default=None, description=\"\u0424\u0438\u043b\u044c\u0442\u0440 \u043f\u043e \u0441\u0442\u0443\u0434\u0435\u043d\u0442\u0443\"),\n    lesson_id: UUID | None = Query(default=None, description=\"\u0424\u0438\u043b\u044c\u0442\u0440 \u043f\u043e \u0443\u0440\u043e\u043a\u0443\"),\n    current_user: TokenPayload = Depends(get_current_user)\n):\n    \"\"\"Get list of visits with optional filters.\"\"\"\n    return await visit_service.get_visits(student_id, lesson_id)\n</code></pre>"},{"location":"api/routers/visits/#app.routers.visits.get_visit","title":"get_visit  <code>async</code>","text":"<pre><code>get_visit(visit_id: UUID, current_user: TokenPayload = Depends(get_current_user))\n</code></pre> <p>Get visit by ID.</p> Source code in <code>app/routers/visits.py</code> <pre><code>@router.get(\n    \"/{visit_id}\",\n    response_model=visit_response,\n    summary=\"\u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u043f\u043e\u0441\u0435\u0449\u0435\u043d\u0438\u0435 \u043f\u043e ID\",\n    description=\"\u0412\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0435 \u043f\u043e\u0441\u0435\u0449\u0435\u043d\u0438\u044f \u043f\u043e \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u043e\u043c\u0443 ID\"\n)\n@traced(\"router.visits.get_visit\", record_args=True, record_result=True)\nasync def get_visit(\n    visit_id: UUID,\n    current_user: TokenPayload = Depends(get_current_user)\n):\n    \"\"\"Get visit by ID.\"\"\"\n    return await visit_service.get_visit(visit_id)\n</code></pre>"},{"location":"api/routers/visits/#app.routers.visits.create_visit","title":"create_visit  <code>async</code>","text":"<pre><code>create_visit(visit: visit_create, current_user: TokenPayload = Depends(require_roles('admin', 'teacher')))\n</code></pre> <p>Create a new visit record.</p> Source code in <code>app/routers/visits.py</code> <pre><code>@router.post(\n    \"\",\n    response_model=visit_response,\n    status_code=status.HTTP_201_CREATED,\n    summary=\"\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043f\u043e\u0441\u0435\u0449\u0435\u043d\u0438\u0435 \u0443\u0440\u043e\u043a\u0430\",\n    description=\"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u0443\u0435\u0442 \u043f\u043e\u0441\u0435\u0449\u0435\u043d\u0438\u0435 \u0443\u0440\u043e\u043a\u0430 \u0441\u0442\u0443\u0434\u0435\u043d\u0442\u043e\u043c\"\n)\n@traced(\"router.visits.create_visit\", record_args=True, record_result=True)\nasync def create_visit(\n    visit: visit_create,\n    current_user: TokenPayload = Depends(require_roles(\"admin\", \"teacher\"))\n):\n    \"\"\"Create a new visit record.\"\"\"\n    return await visit_service.create_visit(visit)\n</code></pre>"},{"location":"api/routers/visits/#app.routers.visits.delete_visit","title":"delete_visit  <code>async</code>","text":"<pre><code>delete_visit(visit_id: UUID)\n</code></pre> <p>Delete visit by ID.</p> Source code in <code>app/routers/visits.py</code> <pre><code>@router.delete(\n    \"/{visit_id}\",\n    status_code=status.HTTP_204_NO_CONTENT,\n    summary=\"\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u0437\u0430\u043f\u0438\u0441\u044c \u043e \u043f\u043e\u0441\u0435\u0449\u0435\u043d\u0438\u0438\",\n    description=\"\u0423\u0434\u0430\u043b\u044f\u0435\u0442 \u0437\u0430\u043f\u0438\u0441\u044c \u043e \u043f\u043e\u0441\u0435\u0449\u0435\u043d\u0438\u0438 \u0443\u0440\u043e\u043a\u0430\"\n)\n@traced(\"router.visits.delete_visit\", record_args=True, record_result=True)\nasync def delete_visit(visit_id: UUID):\n    \"\"\"Delete visit by ID.\"\"\"\n    await visit_service.delete_visit(visit_id)\n    return None\n</code></pre>"},{"location":"api/schemas/certificate/","title":"\u0421\u0445\u0435\u043c\u0430 \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u0430","text":"<p>Pydantic \u043c\u043e\u0434\u0435\u043b\u0438 \u0434\u043b\u044f \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0432.</p>"},{"location":"api/schemas/certificate/#api-reference","title":"API Reference","text":"<p>Certificate schemas.</p>"},{"location":"api/schemas/certificate/#app.schemas.certificate-classes","title":"Classes","text":""},{"location":"api/schemas/certificate/#app.schemas.certificate.certificate_base","title":"certificate_base","text":"<p>               Bases: <code>BaseModel</code></p> <p>Base certificate schema.</p>"},{"location":"api/schemas/certificate/#app.schemas.certificate.certificate_create","title":"certificate_create","text":"<p>               Bases: <code>certificate_base</code></p> <p>Schema for creating a certificate.</p>"},{"location":"api/schemas/certificate/#app.schemas.certificate.certificate_response","title":"certificate_response","text":"<p>               Bases: <code>BaseModel</code></p> <p>Schema for certificate response.</p>"},{"location":"api/schemas/certificate/#app.schemas.certificate-functions","title":"Functions","text":""},{"location":"api/schemas/common/","title":"\u041e\u0431\u0449\u0438\u0435 \u0441\u0445\u0435\u043c\u044b","text":"<p>\u0411\u0430\u0437\u043e\u0432\u044b\u0435 Pydantic \u043c\u043e\u0434\u0435\u043b\u0438 \u0438 \u043e\u0431\u0449\u0438\u0435 \u0442\u0438\u043f\u044b.</p>"},{"location":"api/schemas/common/#api-reference","title":"API Reference","text":"<p>Common schemas used across the application.</p>"},{"location":"api/schemas/common/#app.schemas.common-classes","title":"Classes","text":""},{"location":"api/schemas/common/#app.schemas.common.api_response","title":"api_response","text":"<p>               Bases: <code>BaseModel</code>, <code>Generic[T]</code></p> <p>Standard API response wrapper.</p>"},{"location":"api/schemas/common/#app.schemas.common.api_error_response","title":"api_error_response","text":"<p>               Bases: <code>BaseModel</code></p> <p>Standard API error response.</p>"},{"location":"api/schemas/common/#app.schemas.common.paginated_response","title":"paginated_response","text":"<p>               Bases: <code>BaseModel</code>, <code>Generic[T]</code></p> <p>Paginated response schema.</p>"},{"location":"api/schemas/common/#app.schemas.common.error_response","title":"error_response","text":"<p>               Bases: <code>BaseModel</code></p> <p>Error response schema.</p>"},{"location":"api/schemas/common/#app.schemas.common.message_response","title":"message_response","text":"<p>               Bases: <code>BaseModel</code></p> <p>Simple message response.</p>"},{"location":"api/schemas/common/#app.schemas.common.token_response","title":"token_response","text":"<p>               Bases: <code>BaseModel</code></p> <p>Token response from Keycloak.</p>"},{"location":"api/schemas/common/#app.schemas.common.user_info_response","title":"user_info_response","text":"<p>               Bases: <code>BaseModel</code></p> <p>User info from token.</p>"},{"location":"api/schemas/common/#app.schemas.common.register_request","title":"register_request","text":"<p>               Bases: <code>BaseModel</code></p> <p>User registration request.</p>"},{"location":"api/schemas/common/#app.schemas.common.register_response","title":"register_response","text":"<p>               Bases: <code>BaseModel</code></p> <p>User registration response.</p>"},{"location":"api/schemas/student/","title":"\u0421\u0445\u0435\u043c\u0430 \u0441\u0442\u0443\u0434\u0435\u043d\u0442\u0430","text":"<p>Pydantic \u043c\u043e\u0434\u0435\u043b\u0438 \u0434\u043b\u044f \u0441\u0442\u0443\u0434\u0435\u043d\u0442\u043e\u0432.</p>"},{"location":"api/schemas/student/#_2","title":"\u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435","text":"<ul> <li>\u0412\u0445\u043e\u0434\u043d\u044b\u0435/\u0432\u044b\u0445\u043e\u0434\u043d\u044b\u0435 \u0441\u0445\u0435\u043c\u044b</li> <li>\u0412\u0430\u043b\u0438\u0434\u0430\u0446\u0438\u044f \u0434\u0430\u043d\u043d\u044b\u0445</li> </ul>"},{"location":"api/schemas/student/#api-reference","title":"API Reference","text":"<p>Student schemas.</p>"},{"location":"api/schemas/student/#app.schemas.student-classes","title":"Classes","text":""},{"location":"api/schemas/student/#app.schemas.student.student_base","title":"student_base","text":"<p>               Bases: <code>BaseModel</code></p> <p>Base student schema with common fields.</p>"},{"location":"api/schemas/student/#app.schemas.student.student_create","title":"student_create","text":"<p>               Bases: <code>student_base</code></p> <p>Schema for creating a student.</p>"},{"location":"api/schemas/student/#app.schemas.student.student_update","title":"student_update","text":"<p>               Bases: <code>BaseModel</code></p> <p>Schema for updating a student. All fields are optional.</p>"},{"location":"api/schemas/student/#app.schemas.student.student_response","title":"student_response","text":"<p>               Bases: <code>student_base</code></p> <p>Schema for student response.</p>"},{"location":"api/schemas/student/#app.schemas.student-functions","title":"Functions","text":""},{"location":"api/schemas/validators/","title":"\u0412\u0430\u043b\u0438\u0434\u0430\u0442\u043e\u0440\u044b","text":"<p>\u041a\u0430\u0441\u0442\u043e\u043c\u043d\u044b\u0435 Pydantic \u0432\u0430\u043b\u0438\u0434\u0430\u0442\u043e\u0440\u044b.</p>"},{"location":"api/schemas/validators/#api-reference","title":"API Reference","text":"<p>Utility validators shared across Pydantic schemas.</p>"},{"location":"api/schemas/validators/#app.schemas.validators-functions","title":"Functions","text":""},{"location":"api/schemas/validators/#app.schemas.validators.ensure_safe_string","title":"ensure_safe_string","text":"<pre><code>ensure_safe_string(value: str | None, field_name: str) -&gt; str | None\n</code></pre> <p>Ensure that the provided string doesn't contain obvious SQL-injection payloads.</p> Source code in <code>app/schemas/validators.py</code> <pre><code>def ensure_safe_string(value: str | None, field_name: str) -&gt; str | None:\n    \"\"\"Ensure that the provided string doesn't contain obvious SQL-injection payloads.\"\"\"\n    if value is None:\n        return None\n\n    if _SQL_META_CHARS.search(value):\n        raise ValueError(f\"\u041f\u043e\u043b\u0435 '{field_name}' \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 \u0437\u0430\u043f\u0440\u0435\u0449\u0451\u043d\u043d\u044b\u0435 \u0441\u0438\u043c\u0432\u043e\u043b\u044b SQL\")\n\n    for pattern in _SQL_UNSAFE_PATTERNS:\n        if pattern.search(value):\n            raise ValueError(\n                f\"\u041f\u043e\u043b\u0435 '{field_name}' \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 \u043f\u043e\u0442\u0435\u043d\u0446\u0438\u0430\u043b\u044c\u043d\u043e \u043e\u043f\u0430\u0441\u043d\u0443\u044e SQL-\u043a\u043e\u043d\u0441\u0442\u0440\u0443\u043a\u0446\u0438\u044e\",\n            )\n\n    return value\n</code></pre>"},{"location":"api/schemas/validators/#app.schemas.validators.ensure_safe_mapping","title":"ensure_safe_mapping","text":"<pre><code>ensure_safe_mapping(mapping: dict[str, Any] | None, field_name: str) -&gt; dict[str, Any] | None\n</code></pre> <p>Recursively validate every string inside a mapping.</p> Source code in <code>app/schemas/validators.py</code> <pre><code>def ensure_safe_mapping(mapping: dict[str, Any] | None, field_name: str) -&gt; dict[str, Any] | None:\n    \"\"\"Recursively validate every string inside a mapping.\"\"\"\n    if not mapping:\n        return mapping\n\n    validated: dict[str, Any] = {}\n    for key, val in mapping.items():\n        if isinstance(val, str):\n            validated[key] = ensure_safe_string(val, f\"{field_name}.{key}\")\n        elif isinstance(val, dict):\n            validated[key] = ensure_safe_mapping(val, f\"{field_name}.{key}\")\n        else:\n            validated[key] = val\n    return validated\n</code></pre>"},{"location":"api/schemas/visit/","title":"\u0421\u0445\u0435\u043c\u0430 \u0432\u0438\u0437\u0438\u0442\u0430","text":"<p>Pydantic \u043c\u043e\u0434\u0435\u043b\u0438 \u0434\u043b\u044f \u0443\u0447\u0451\u0442\u0430 \u043f\u043e\u0441\u0435\u0449\u0435\u043d\u0438\u0439.</p>"},{"location":"api/schemas/visit/#api-reference","title":"API Reference","text":"<p>Visit schemas.</p>"},{"location":"api/schemas/visit/#app.schemas.visit-classes","title":"Classes","text":""},{"location":"api/schemas/visit/#app.schemas.visit.visit_base","title":"visit_base","text":"<p>               Bases: <code>BaseModel</code></p> <p>Base visit schema.</p>"},{"location":"api/schemas/visit/#app.schemas.visit.visit_create","title":"visit_create","text":"<p>               Bases: <code>visit_base</code></p> <p>Schema for creating a visit.</p>"},{"location":"api/schemas/visit/#app.schemas.visit.visit_response","title":"visit_response","text":"<p>               Bases: <code>visit_base</code></p> <p>Schema for visit response.</p>"},{"location":"api/services/auth/","title":"Auth Service","text":"<p>\u0421\u0435\u0440\u0432\u0438\u0441 \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u0438.</p>"},{"location":"api/services/auth/#api-reference","title":"API Reference","text":"<p>Authentication service using Keycloak.</p>"},{"location":"api/services/auth/#app.services.auth-classes","title":"Classes","text":""},{"location":"api/services/auth/#app.services.auth.AuthService","title":"AuthService","text":"<p>High-level authentication logic.</p>"},{"location":"api/services/auth/#app.services.auth.AuthService-functions","title":"Functions","text":""},{"location":"api/services/auth/#app.services.auth.AuthService.get_login_url","title":"get_login_url","text":"<pre><code>get_login_url() -&gt; str\n</code></pre> <p>Generate Keycloak login URL.</p> Source code in <code>app/services/auth.py</code> <pre><code>@traced(\"auth.get_login_url\", record_result=True)\ndef get_login_url(self) -&gt; str:\n    \"\"\"Generate Keycloak login URL.\"\"\"\n    redirect_uri = settings.KEYCLOAK_REDIRECT_URI\n    return keycloak_service.get_auth_url(redirect_uri)\n</code></pre>"},{"location":"api/services/auth/#app.services.auth.AuthService.exchange_code_for_token","title":"exchange_code_for_token  <code>async</code>","text":"<pre><code>exchange_code_for_token(code: str) -&gt; Dict[str, Any]\n</code></pre> <p>Exchange authorization code for access token.</p> Source code in <code>app/services/auth.py</code> <pre><code>@traced(\"auth.exchange_code\", record_args=True, record_result=True)\nasync def exchange_code_for_token(self, code: str) -&gt; Dict[str, Any]:\n    \"\"\"Exchange authorization code for access token.\"\"\"\n    redirect_uri = settings.KEYCLOAK_REDIRECT_URI\n\n    try:\n        return await run_in_threadpool(\n            keycloak_service.get_token,\n            code,\n            redirect_uri\n        )\n    except Exception as e:\n        logger.error(f\"Token exchange failed: {e}\")\n        raise HTTPException(\n            status_code=status.HTTP_401_UNAUTHORIZED,\n            detail=\"Failed to exchange code for token\"\n        )\n</code></pre>"},{"location":"api/services/auth/#app.services.auth.AuthService.refresh_token","title":"refresh_token  <code>async</code>","text":"<pre><code>refresh_token(refresh_token: str) -&gt; Dict[str, Any]\n</code></pre> <p>Refresh access token using refresh token.</p> Source code in <code>app/services/auth.py</code> <pre><code>@traced(\"auth.refresh\", record_args=True, record_result=True)\nasync def refresh_token(self, refresh_token: str) -&gt; Dict[str, Any]:\n    \"\"\"Refresh access token using refresh token.\"\"\"\n    try:\n        return await run_in_threadpool(\n            keycloak_service.refresh_token,\n            refresh_token\n        )\n    except Exception as e:\n        logger.error(f\"Token refresh failed: {e}\")\n        raise HTTPException(\n            status_code=status.HTTP_401_UNAUTHORIZED,\n            detail=\"Invalid refresh token\"\n        )\n</code></pre>"},{"location":"api/services/auth/#app.services.auth.AuthService.logout","title":"logout  <code>async</code>","text":"<pre><code>logout(refresh_token: str) -&gt; None\n</code></pre> <p>Logout user.</p> Source code in <code>app/services/auth.py</code> <pre><code>@traced(\"auth.logout\", record_args=True, record_result=True)\nasync def logout(self, refresh_token: str) -&gt; None:\n    \"\"\"Logout user.\"\"\"\n    try:\n        await run_in_threadpool(keycloak_service.logout, refresh_token)\n    except Exception as e:\n        logger.warning(f\"Logout failed: {e}\")\n</code></pre>"},{"location":"api/services/auth/#app.services.auth.AuthService.register_user","title":"register_user  <code>async</code>","text":"<pre><code>register_user(username: str, email: str, password: str, first_name: str, last_name: str) -&gt; Dict[str, str]\n</code></pre> <p>Registers a user in Keycloak.</p> Source code in <code>app/services/auth.py</code> <pre><code>@traced(\"auth.register_user\", record_args=True, record_result=True)\nasync def register_user(self, username: str, email: str, password: str, first_name: str, last_name: str) -&gt; Dict[str, str]:\n    \"\"\"Registers a user in Keycloak.\"\"\"\n    user_data = {\n        \"username\": username,\n        \"email\": email,\n        \"firstName\": first_name,\n        \"lastName\": last_name,\n        \"enabled\": True,\n        \"credentials\": [{\"value\": password, \"type\": \"password\", \"temporary\": False}],\n        \"emailVerified\": settings.KEYCLOAK_USER_EMAIL_VERIFIED_DEFAULT\n    }\n\n    try:\n        # \u0421\u043e\u0437\u0434\u0430\u0435\u043c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u0432 Keycloak\n        user_id = await run_in_threadpool(\n            keycloak_service.create_user,\n            user_data\n        )\n\n        logger.info(f\"User registered successfully: {username}\")\n\n        return {\n            \"user_id\": user_id,\n            \"username\": username,\n            \"email\": email\n        }\n    except Exception as e:\n        # \u041e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u043e\u0448\u0438\u0431\u043e\u043a Keycloak\n        error_msg = str(e)\n        if \"409\" in error_msg or \"already exists\" in error_msg.lower():\n            raise HTTPException(status_code=409, detail=\"User already exists\")\n\n        logger.error(f\"Registration failed: {e}\")\n        raise HTTPException(status_code=500, detail=\"Registration failed\")\n</code></pre>"},{"location":"api/services/auth/#app.services.auth-functions","title":"Functions","text":""},{"location":"api/services/certificate/","title":"Certificate Service","text":"<p>\u0421\u0435\u0440\u0432\u0438\u0441 \u0434\u043b\u044f \u0440\u0430\u0431\u043e\u0442\u044b \u0441 \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u0430\u043c\u0438 \u0441\u0442\u0443\u0434\u0435\u043d\u0442\u043e\u0432.</p>"},{"location":"api/services/certificate/#api-reference","title":"API Reference","text":"<p>Certificate service layer.</p>"},{"location":"api/services/certificate/#app.services.certificate-attributes","title":"Attributes","text":""},{"location":"api/services/certificate/#app.services.certificate.certificate_service","title":"certificate_service  <code>module-attribute</code>","text":"<pre><code>certificate_service = certificate_service()\n</code></pre> <p>Service for certificate business logic.</p>"},{"location":"api/services/certificate/#app.services.certificate-classes","title":"Classes","text":""},{"location":"api/services/certificate/#app.services.certificate-functions","title":"Functions","text":""},{"location":"api/services/keycloak/","title":"Keycloak Service","text":"<p>\u0421\u0435\u0440\u0432\u0438\u0441 \u0438\u043d\u0442\u0435\u0433\u0440\u0430\u0446\u0438\u0438 \u0441 Keycloak OAuth2/OIDC.</p>"},{"location":"api/services/keycloak/#_1","title":"\u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435","text":"<p>\u041e\u0431\u0435\u0441\u043f\u0435\u0447\u0438\u0432\u0430\u0435\u0442:</p> <ul> <li>\u041f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u0435 \u0442\u043e\u043a\u0435\u043d\u043e\u0432 \u043e\u0442 Keycloak</li> <li>\u041e\u0431\u043c\u0435\u043d \u0443\u0447\u0451\u0442\u043d\u044b\u0445 \u0434\u0430\u043d\u043d\u044b\u0445</li> <li>Logout</li> </ul>"},{"location":"api/services/keycloak/#api-reference","title":"API Reference","text":""},{"location":"api/services/keycloak/#app.services.keycloak-classes","title":"Classes","text":""},{"location":"api/services/keycloak/#app.services.keycloak.KeycloakService","title":"KeycloakService","text":"<pre><code>KeycloakService()\n</code></pre> <p>Service for direct interactions with Keycloak API.</p> Source code in <code>app/services/keycloak.py</code> <pre><code>def __init__(self):\n    # 1. \u041d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0430 OpenID (\u0434\u043b\u044f \u043b\u043e\u0433\u0438\u043d\u0430 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439)\n    self.openid = KeycloakOpenID(\n        server_url=settings.KEYCLOAK_SERVER_URL,\n        client_id=settings.KEYCLOAK_CLIENT_ID,\n        realm_name=settings.KEYCLOAK_REALM,\n        client_secret_key=settings.KEYCLOAK_CLIENT_SECRET,\n        verify=True\n    )\n\n    # 2. \u041d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0430 Admin (\u0434\u043b\u044f \u0443\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u044f \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f\u043c\u0438)\n    # \u0412\u0430\u0436\u043d\u043e: \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u0435\u043c \u043b\u0435\u043d\u0438\u0432\u043e \u0438\u043b\u0438 \u0441\u0440\u0430\u0437\u0443, \u043d\u043e \u0441 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u043e\u0439 \u043e\u0448\u0438\u0431\u043e\u043a\n    self._admin_client = None\n</code></pre>"},{"location":"api/services/keycloak/#app.services.keycloak.KeycloakService-attributes","title":"Attributes","text":""},{"location":"api/services/keycloak/#app.services.keycloak.KeycloakService.admin","title":"admin  <code>property</code>","text":"<pre><code>admin: KeycloakAdmin\n</code></pre> <p>Lazy initialization of Keycloak Admin client.</p>"},{"location":"api/services/keycloak/#app.services.keycloak.KeycloakService-functions","title":"Functions","text":""},{"location":"api/services/keycloak/#app.services.keycloak.KeycloakService.create_user","title":"create_user","text":"<pre><code>create_user(user_data: Dict[str, Any]) -&gt; str\n</code></pre> <p>Creates a user and returns their ID.</p> Source code in <code>app/services/keycloak.py</code> <pre><code>@traced(\"keycloak.create_user\", record_args=True, record_result=True)\ndef create_user(self, user_data: Dict[str, Any]) -&gt; str:\n    \"\"\"Creates a user and returns their ID.\"\"\"\n    return self.admin.create_user(user_data)\n</code></pre>"},{"location":"api/services/keycloak/#app.services.keycloak-functions","title":"Functions","text":""},{"location":"api/services/student/","title":"Student Service","text":"<p>\u0421\u0435\u0440\u0432\u0438\u0441 \u0431\u0438\u0437\u043d\u0435\u0441-\u043b\u043e\u0433\u0438\u043a\u0438 \u0434\u043b\u044f \u0440\u0430\u0431\u043e\u0442\u044b \u0441\u043e \u0441\u0442\u0443\u0434\u0435\u043d\u0442\u0430\u043c\u0438.</p>"},{"location":"api/services/student/#_1","title":"\u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435","text":"<p><code>StudentService</code> \u0438\u043d\u043a\u0430\u043f\u0441\u0443\u043b\u0438\u0440\u0443\u0435\u0442 \u0432\u0441\u044e \u0431\u0438\u0437\u043d\u0435\u0441-\u043b\u043e\u0433\u0438\u043a\u0443 \u0440\u0430\u0431\u043e\u0442\u044b \u0441\u043e \u0441\u0442\u0443\u0434\u0435\u043d\u0442\u0430\u043c\u0438:</p> <ul> <li>\u0412\u0430\u043b\u0438\u0434\u0430\u0446\u0438\u044f \u0434\u0430\u043d\u043d\u044b\u0445</li> <li>\u041f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u0434\u0443\u0431\u043b\u0438\u043a\u0430\u0442\u043e\u0432 email</li> <li>\u041f\u0430\u0433\u0438\u043d\u0430\u0446\u0438\u044f</li> <li>\u041e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u043e\u0448\u0438\u0431\u043e\u043a</li> </ul>"},{"location":"api/services/student/#api-reference","title":"API Reference","text":"<p>Student service layer.</p>"},{"location":"api/services/student/#app.services.student-attributes","title":"Attributes","text":""},{"location":"api/services/student/#app.services.student.student_service","title":"student_service  <code>module-attribute</code>","text":"<pre><code>student_service = student_service()\n</code></pre> <p>Service for student business logic.</p>"},{"location":"api/services/student/#app.services.student-classes","title":"Classes","text":""},{"location":"api/services/student/#app.services.student-functions","title":"Functions","text":""},{"location":"api/services/visit/","title":"Visit Service","text":"<p>\u0421\u0435\u0440\u0432\u0438\u0441 \u0434\u043b\u044f \u043e\u0442\u0441\u043b\u0435\u0436\u0438\u0432\u0430\u043d\u0438\u044f \u043f\u043e\u0441\u0435\u0449\u0430\u0435\u043c\u043e\u0441\u0442\u0438.</p>"},{"location":"api/services/visit/#api-reference","title":"API Reference","text":"<p>Visit service layer.</p>"},{"location":"api/services/visit/#app.services.visit-attributes","title":"Attributes","text":""},{"location":"api/services/visit/#app.services.visit.visit_service","title":"visit_service  <code>module-attribute</code>","text":"<pre><code>visit_service = visit_service()\n</code></pre> <p>Service for visit business logic.</p>"},{"location":"api/services/visit/#app.services.visit-classes","title":"Classes","text":""},{"location":"api/services/visit/#app.services.visit-functions","title":"Functions","text":""}]}